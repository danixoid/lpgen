var pageContainer="#page";var enablePreview=true;var theBody;var editableItems=new Array();editableItems[".frameCover"]=[];editableItems["nav#main-navbar"]=["background-color","box-shadow"];editableItems["nav a"]=["font-weight","font-size","text-transform"];editableItems["nav a.btn-nav"]=["font-weight","font-size","background-color"];editableItems[".nav-callus"]=["color","font-weight","font-size","text-transform"];editableItems["a.edit"]=["color","font-weight","font-size","text-transform"];editableItems[".text-edit"]=["color","font-weight","font-size","text-transform","background-color"];editableItems.img=["border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius","border-color","border-style","border-width"];editableItems[".bg-img"]=["background-color"];editableItems.h1=["color","font-size","background-color","font-family","font-weight"];editableItems.h2=["color","font-size","background-color","font-family","font-weight"];editableItems.h3=["color","font-size","background-color","font-family","font-weight"];editableItems.h4=["color","font-size","background-color","font-family","font-weight"];editableItems.h5=["color","font-size","background-color","font-family","font-weight"];editableItems.h6=["color","font-size","background-color","font-family","font-weight"];editableItems.p=["color","font-size","background-color","font-family","font-weight"];editableItems["a.btn, button.btn, .btn"]=["border-radius","font-size","background-color","box-shadow","border-color","border-style","border-width"];editableItems[".bg-edit"]=["background-color"];editableItems[".block-edit"]=["background-image"];editableItems["i, span.fa"]=["color","font-size"];var editableItemOptions=new Array();editableItemOptions["nav a : font-weight"]=["700","300","400","900"];editableItemOptions["nav a.btn-nav : font-weight"]=["700","300","400","900"];editableItemOptions["img : border-style"]=["none","dotted","dashed","solid"];editableItemOptions["img : border-width"]=["1px","2px","3px","4px"];editableItemOptions["h1 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h2 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h3 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h4 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h5 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h6 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["p : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];var editableContent=[".editContent",".navbar a","a.edit","h1:not(.no-edit)","h2:not(.no-edit)","h3:not(.no-edit)","h4:not(.no-edit)","h5:not(.no-edit)","h6:not(.no-edit)","p:not(.no-edit)",".nav-callus",".text-edit",".btn:not(.no-edit)",".footer a:not(.fa)",".tableWrapper"];$(function(){$(".nav-tabs a").on("click",function(a){a.preventDefault();$(this).tab("show")})});var mainMenuWidth=230;var secondMenuWidth=300;$(window).load(function(){$("#loader").fadeOut(function(){$("#menu").animate({left:"-190px"},1000)});if(enablePreview==true){$("#preview").show()}loadPagesByDomain($("#selectDomain").val());$("#viewSite").attr("href","http://"+$("#selectAlias option:selected").text());$("#selectAlias").on("change",function(a){$("#viewSite").attr("href","http://"+$("#selectAlias option:selected").text())});$("#preview").on("click",function(){window.open("/builder/preview/"+$("#selectDomain").val()+"/"+$("#pageTitle span span").text(),"_blank")});$("#exportPage").on("click",function(a){if(confirm("Все страницы будут опубликованы для всех поддоменов и алиасов. Уверены?")){$.ajax({url:"/builder/publish",data:JSON.stringify({domain_id:$("#selectDomain").val(),alias_id:$("#selectAlias").val()}),type:"POST"}).done(function(b){$("#savePage span.bLabel").html($("#savePage span.bLabel").html()+"/Опубликовано")}).error(function(b){alert("Ошибка публикации. Попробуйте еще раз. Или обратитесь к администратору.")})}});$("#auth").submit(function(b){var a=$(this);b.preventDefault();$.get("/_token",function(c){$.ajaxSetup({headers:{"X-CSRF-TOKEN":c._token}});$.ajax({url:a.attr("action"),data:a.serialize(),dataType:"json",type:"POST"}).done(function(d){$("#auth .modal").modal("hide");savePage(b)}).error(function(d){var e="";console.log(d.responseText);$.each(JSON.parse(d.responseText),function(f,g){e+=g+"\n"});alert(e)})})})});function loadPagesByDomain(a){var d=$("#getBlocksForm");var b=d.attr("action");var c=d.attr("method");$("#domainHidden").val(a);$.ajax({url:b+"?domain_id="+a,cache:false,contentType:false,processData:false,dataType:"json",type:c}).done(function(h){$("#pageList ul#page1").empty();$("#pageList ul.generate-ul").remove();$("ul#pages li.generate-li").remove();var l=[];for(x=0;x<h.length;x++){var e=x+1;if($("ul#page"+e).size()==0){var f=$('<ul id="page'+e+'" class="generate-ul"></ul>');$("#pageList").append(f);makeSortable(f);var m=$('<option value="/'+h[x].name+'">'+h[x].name+"</option>");$("#internalLinksDropdown").append(m)}for(var p=0;p<h[x].l_blocks.length;p++){$("#start").hide();if(h[x].l_blocks[p]!=null){var n=$("<li>"+h[x].l_blocks[p].frame+"</li>");n.find("iframe").attr("id","ui-id-"+x+p);n.find(".frameCover").show();n.find(".frameCover").css("height","100%");var o=n.find("iframe").attr("data-sandbox");if(typeof o!==typeof undefined&&o!==false){var j=n.find("iframe");var k=j.attr("data-sandbox");var g=$('<iframe src="'+j.attr("src")+'" id="'+k+'" sandbox="allow-same-origin"></iframe>');$("#sandboxes").append(g)}l[n.find("iframe").attr("id")]=h[x].l_blocks[p].element;n.find("iframe").load(function(){$(this).contents().find(pageContainer).html(l[$(this).attr("id")]);var q=$(this).attr("data-sandbox");if(typeof q!==typeof undefined&&q!==false){$("iframe#"+$(this).attr("data-sandbox")).contents().find(pageContainer).html(l[$(this).attr("id")]);var s=$(this).data("data-loaderfunction");j=$(this);var r="theiFrame[0].contentWindow."+j.attr("data-loaderfunction")+"()";var t=new Function(r);t()}});$("ul#page"+e).append(n)}}if(e>1&&typeof h[x].name!="undefined"){var i=$('<li class="generate-li"><a class="plink" href="#page'+e+'">'+h[x].name+'</a><span class="pageButtons"><a class="fileEdit" href=""><span class="fui-new"></span></a><a class="fileDel" href=""><span class="fui-cross"></span></a><a href="#" class="btn btn-xs btn-primary btn-embossed fileSave"><span class="fui-check"></span></a></span></li>');$("ul#pages").append(i)}}allEmpty()})}var hexDigits=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function rgb2hex(a){a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return"#"+hex(a[1])+hex(a[2])+hex(a[3])}function hex(a){return isNaN(a)?"00":hexDigits[(a-a%16)/16]+hexDigits[a%16]}function getRandomArbitrary(b,a){return Math.floor(Math.random()*(a-b)+b)}var pendingChanges=false;function setPendingChanges(a){if(a==true){$(window).bind("beforeunload",function(){return">>>>>Before You Go<<<<<<<< \n Your custom message go here"});$("#savePage .bLabel").text("Сохранить изменения (!)");pendingChanges=true}else{$(window).unbind("beforeunload");$("#savePage .bLabel").text("Сохранено");pendingChanges=false}}function pageEmpty(){if($("#pageList ul:visible > li").size()==0){$("#start").show();$("#frameWrapper").addClass("empty")}else{$("#start").hide();$("#frameWrapper").removeClass("empty")}}function allEmpty(){var a=false;if($("#pageList li").size()==0){a=true}else{a=false}if(a){$("a.actionButtons").each(function(){$(this).addClass("disabled")});$("header .modes input").each(function(){$(this).prop("disabled",true).parent().addClass("disabled")})}else{$("header .modes input").each(function(){$(this).prop("disabled",false).parent().removeClass("disabled")});$("a.actionButtons").each(function(){$(this).removeClass("disabled")})}}function makeDraggable(a){$("#second #elements li").each(function(){$(this).draggable({helper:function(){return $('<div style="height: 100px; width: 300px; background: #F9FAFA; box-shadow: 5px 5px 1px rgba(0,0,0,0.1); text-align: center; line-height: 100px; font-size: 28px; color: #16A085"><span class="fui-list"></span></div>')},revert:"invalid",appendTo:"body",connectToSortable:a,stop:function(){pageEmpty();allEmpty()},start:function(){$("input:radio[name=mode]").parent().addClass("disabled");$("input:radio[name=mode]#modeBlock").radio("check");$("#pageList ul .zoomer-wrapper .zoomer-cover").each(function(){$(this).show()});$("#pageList ul li iframe").each(function(){this.contentDocument.designMode="off"})}})});$("#elements li a").each(function(){$(this).unbind("click").bind("click",function(b){b.preventDefault()})})}var frameContents="";function makeSortable(a){a.sortable({revert:true,placeholder:"drop-hover",handle:".frameCover",beforeStop:function(b,k){var f;var j;var c;var g;var d;if(k.item.find(".frameCover").size()==0){if(k.item.find("iframe").size()>0){f=k.item.height();j=k.item.find("iframe").attr("data-sandbox");if(typeof j!==typeof undefined&&j!==false){g=getRandomArbitrary(10000,1000000000);d=$('<iframe src="'+k.item.find("iframe").attr("src")+'" id="'+g+'" sandbox="allow-same-origin"></iframe>');$("#sandboxes").append(d);if(typeof k.item.find("iframe").attr("data-loaderfunction")!==typeof undefined&&k.item.find("iframe").attr("data-loaderfunction")!==false){c='data-loaderfunction="'+k.item.find("iframe").attr("data-loaderfunction")+'"'}k.item.html('<iframe src="'+k.item.find("iframe").attr("src")+'" scrolling="no" frameborder="0" data-sandbox="'+g+'" '+c+"><iframe>")}else{k.item.html('<iframe src="'+k.item.find("iframe").attr("src")+'" scrolling="no" frameborder="0"><iframe>')}k.item.find("iframe").uniqueId();k.item.find("iframe").height(f+"px")}else{f=k.item.find("img").attr("data-height");j=k.item.find("img").attr("data-sandbox");if(typeof j!==typeof undefined&&j!==false){g=getRandomArbitrary(10000,1000000000);d=$('<iframe src="'+k.item.find("img").attr("data-srcc")+'" id="'+g+'" sandbox="allow-same-origin"></iframe>');$("#sandboxes").append(d);if(typeof k.item.find("img").attr("data-loaderfunction")!==typeof undefined&&k.item.find("img").attr("data-loaderfunction")!==false){c='data-loaderfunction="'+k.item.find("img").attr("data-loaderfunction")+'"'}k.item.html('<iframe src="'+k.item.find("img").attr("data-srcc")+'" scrolling="no" frameborder="0" data-sandbox="'+g+'" '+c+"><iframe>")}else{k.item.html('<iframe src="'+k.item.find("img").attr("data-srcc")+'" scrolling="no" frameborder="0"><iframe>')}k.item.find("iframe").uniqueId();k.item.find("iframe").height(f+"px");k.item.find("iframe").css("background","#ffffff url(images/loading.gif) 50% 50% no-repeat");k.item.find("iframe").load(function(){heightAdjustment(k.item.find("iframe").attr("id"),true)})}var e=$('<button type="button" class="btn btn-danger deleteBlock"><span class="fui-trash"></span> Удалить</button>');var l=$('<button type="button" class="btn btn-warning resetBlock"><i class="fa fa-refresh"></i> Сброс</button>');var h=$('<button type="button" class="btn btn-inverse htmlBlock"><i class="fa fa-code"></i> Код</button>');var i=$('<div class="frameCover"></div>');i.append(e);i.append(l);i.append(h);k.item.append(i)}else{k.item.find("iframe").load(function(){$(this).contents().find(pageContainer).html(frameContents)})}setPendingChanges(true)},stop:function(){$("#pageList ul:visible li").each(function(){$(this).find(".zoomer-cover > a").remove()})},start:function(b,c){if(c.item.find(".frameCover").size()!=0){frameContents=c.item.find("iframe").contents().find(pageContainer).html()}},over:function(){$("#start").hide()}})}function buildeStyleElements(d,f){for(var a=0;a<editableItems[f].length;a++){var c=$("#styleElTemplate").clone();c.attr("id","");c.find(".control-label").text(editableItems[f][a]+":");if(f+" : "+editableItems[f][a] in editableItemOptions){c.find("input").remove();var b=$("<select></select>");b.attr("name",editableItems[f][a]);for(z=0;z<editableItemOptions[f+" : "+editableItems[f][a]].length;z++){var e=$('<option value="'+editableItemOptions[f+" : "+editableItems[f][a]][z]+'">'+editableItemOptions[f+" : "+editableItems[f][a]][z]+"</option>");if(editableItemOptions[f+" : "+editableItems[f][a]][z]==$(d).css(editableItems[f][a])){e.attr("selected","true")}b.append(e)}c.append(b);b.selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"})}else{c.find("input").val($(d).css(editableItems[f][a])).attr("name",editableItems[f][a]);if(editableItems[f][a].indexOf("color")>-1){if($(d).css(editableItems[f][a])!="transparent"&&$(d).css(editableItems[f][a])!="none"&&$(d).css(editableItems[f][a])!=""){c.val($(d).css(editableItems[f][a]))}c.find("input").spectrum({preferredFormat:"hex",showPalette:true,allowEmpty:true,showInput:true,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]]})}}c.css("display","block");$("#styleElements").append(c);$("#styleEditor form#stylingForm").height("auto")}}function getParentFrameID(b){var a="";$("#pageList li:visible iframe").each(function(){theBody=$(this).contents().find("body");if($.contains(document.getElementById($(this).attr("id")).contentWindow.document,b)){a=$(this).attr("id")}});if(a!=""){return a}}function heightAdjustment(e,d){var a;var c=e;d=typeof d!=="undefined"?d:false;if(d==false){$("#pageList li:visible iframe").each(function(){theBody=$(this).contents().find("body");if($.contains(document.getElementById($(this).attr("id")).contentWindow.document,e)){c=$(this).attr("id")}})}a=document.getElementById(c);var b=a.contentWindow.document.body.offsetHeight;if(b>0){$(a).height(b+"px");$(a).parent().height((b)+"px");$(a).next().height((b)+"px")}}function hasSandbox(b){var a=$("#"+getParentFrameID(b.get(0))).attr("data-sandbox");if(typeof a!==typeof undefined&&a!==false){return a}else{return false}}var _oldIcon=[];function styleClick(b){var j=$(b).attr("data-selector");$("#editingElement").text(j);$("#detailTabs a:first").click();$("a#link_Link").parent().hide();$("a#img_Link").parent().hide();$("a#icon_Link").parent().hide();$("a#video_Link").parent().hide();if($(b).prop("tagName")=="A"||$(b).parent().prop("tagName")=="A"){var f;$("a#link_Link").parent().show();if($(b).prop("tagName")=="A"){f=$(b).attr("href")}else{if($(b).parent().prop("tagName")=="A"){f=$(b).parent().attr("href")}}var h=0;var d=false;$("select#internalLinksDropdown").prop("selectedIndex",0);$("select#internalLinksDropdown option").each(function(){if($(this).attr("value")==f){$(this).attr("selected",true);h=$(this).index();d=true}});$(".link_Tab .btn-group.select .dropdown-menu li").removeClass("selected");$(".link_Tab .btn-group.select .dropdown-menu li:eq("+h+")").addClass("selected");$(".link_Tab .btn-group.select:eq(0) .filter-option").text($("select#internalLinksDropdown option:selected").text());$(".link_Tab .btn-group.select:eq(1) .filter-option").text($("select#pageLinksDropdown option:selected").text());if(d==true){$("input#internalLinksCustom").val("")}else{if($(b).prop("tagName")=="A"){if($(b).attr("href")[0]!="#"){$("input#internalLinksCustom").val($(b).attr("href"))}else{$("input#internalLinksCustom").val("")}}else{if($(b).parent().prop("tagName")=="A"){if($(b).parent().attr("href")[0]!="#"){$("input#internalLinksCustom").val($(b).parent().attr("href"))}else{$("input#internalLinksCustom").val("")}}}}$("select#pageLinksDropdown option:not(:first)").remove();$("#pageList ul:visible iframe").each(function(){if($(this).contents().find(pageContainer+" > *:first").attr("id")!=undefined){if($(b).attr("href")=="#"+$(this).contents().find(pageContainer+" > *:first").attr("id")){newOption="<option selected value=#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+">#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+"</option>"}else{newOption="<option value=#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+">#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+"</option>"}$("select#pageLinksDropdown").append(newOption)}})}if($(b).attr("data-type")=="video"){$("a#video_Link").parent().show();$("a#video_Link").click();if($(b).prev().attr("src").indexOf("vimeo.com")>-1){e=$(b).prev().attr("src").match(/player\.vimeo\.com\/video\/([0-9]*)/);$("#video_Tab input#vimeoID").val(e[e.length-1]);$("#video_Tab input#youtubeID").val("")}else{var g=/.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/;var e=$(b).prev().attr("src").match(g);$("#video_Tab input#youtubeID").val(e[1]);$("#video_Tab input#vimeoID").val("")}}if($(b).prop("tagName")=="IMG"){$("a#img_Link").parent().show();$(".imageFileTab").find("a.fileinput-exists").click();var i=$(b).attr("src");var a=$('<img src="'+i+'" />');$(".imageFileTab").find(".fileinput-preview").append(a);$(".imageFileTab").find("input#imageURL").val($(b).attr("src"))}if($(b).hasClass("bg-img")){$(".imageFileTab").find("a.fileinput-exists").click();var i=$(b).css("background-image").match(/https?:\/\/[^\"]+/gi)[0];var a=$('<img src="'+i+'"/>');$("a#img_Link").parent().show();$(".imageFileTab").find("input#imageURL").val(i);$(".imageFileTab").find(".fileinput-preview ").append(a)}if($(b).hasClass("fa")){$("a#icon_Link").parent().show();var c=$.grep(b.className.split(" "),function(k,l){return k.indexOf("fa-")===0}).join();$("select#icons option").each(function(){if($(this).val()==c){$(this).attr("selected",true);$("#icons").trigger("chosen:updated")}})}$("#pageList ul:visible li iframe").each(function(){for(var k in editableItems){$(this).contents().find(pageContainer+" "+k).css({outline:"none",cursor:"default"});$(this).contents().find(pageContainer+" "+k).hover(function(l){l.stopPropagation();if($(this).closest("body").width()!=$(this).width()){$(this).css({outline:"3px dashed red",cursor:"pointer"})}else{$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}},function(){if($(this).closest("body").width()!=($(this).width()+6)){$(this).css({outline:"",cursor:""})}else{$(this).css({border:"",cursor:"","outline-offset":""})}})}});$(b).unbind("mouseenter mouseleave");if($(b).closest("body").width()!=$(b).width()){$(b).css({outline:"3px dashed red",cursor:"pointer"})}else{$(b).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}$("#styleElements > *:not(#styleElTemplate)").each(function(){$(this).remove()});buildeStyleElements(b,j);if($("#styleEditor").css("left")=="-300px"){$("#styleEditor").animate({left:"0px"},250)}$("button#saveStyling").unbind("click").bind("click",function(){var o;var l;$("#styleEditor #tab1 .form-group:not(#styleElTemplate) input, #styleEditor #tab1 .form-group:not(#styleElTemplate) select").each(function(){$(b).css($(this).attr("name"),$(this).val());o=hasSandbox($(b));if(o){l=$(b).attr("id");$("#"+o).contents().find("#"+l).css($(this).attr("name"),$(this).val())}});if($(b).prop("tagName")=="A"){if($("select#internalLinksDropdown").val()!="#"){$(b).attr("href",$("select#internalLinksDropdown").val())}else{if($("select#pageLinksDropdown").val()!="#"){$(b).attr("href",$("select#pageLinksDropdown").val())}else{if($("input#internalLinksCustom").val()!=""){$(b).attr("href",$("input#internalLinksCustom").val())}}}o=hasSandbox($(b));if(o){l=$(b).attr("id");if($("select#internalLinksDropdown").val()!="#"){$("#"+o).contents().find("#"+l).attr("href",$("select#internalLinksDropdown").val())}else{if($("select#pageLinksDropdown").val()!="#"){$("#"+o).contents().find("#"+l).attr("href",$("select#pageLinksDropdown").val())}else{if($("input#internalLinksCustom").val()!=""){$("#"+o).contents().find("#"+l).attr("href",$("input#internalLinksCustom").val())}}}}}if($(b).parent().prop("tagName")=="A"){if($("select#internalLinksDropdown").val()!="#"){$(b).parent().attr("href",$("select#internalLinksDropdown").val())}else{if($("select#pageLinksDropdown").val()!="#"){$(b).parent().attr("href",$("select#pageLinksDropdown").val())}else{if($("input#internalLinksCustom").val()!=""){$(b).parent().attr("href",$("input#internalLinksCustom").val())}}}o=hasSandbox($(b));if(o){l=$(b).attr("id");if($("select#internalLinksDropdown").val()!="#"){$("#"+o).contents().find("#"+l).parent().attr("href",$("select#internalLinksDropdown").val())}else{if($("select#pageLinksDropdown").val()!="#"){$("#"+o).contents().find("#"+l).parent().attr("href",$("select#pageLinksDropdown").val())}else{if($("input#internalLinksCustom").val()!=""){$("#"+o).contents().find("#"+l).parent().attr("href",$("input#internalLinksCustom").val())}}}}}if($("a#img_Link").css("display")=="block"&&$("input#imageFileField").val()!=""){var p=$("form#imageUploadForm");var k=false;if(window.FormData){k=new FormData(p[0])}var m=p.attr("action");$.ajax({url:m,data:k?k:p.serialize(),cache:false,contentType:false,processData:false,dataType:"json",type:"POST"}).done(function(s,r){if(r==401){$("#auth.modal").modal("show")}else{if(s.code==1){$(".imageFileTab").find(".fileinput-preview").append(q);$(".imageFileTab").find("input#imageURL").val(s.response);if($(b).hasClass("bg-img")){var q=$('<img src="'+s.response+'" />');var t="url('"+s.response+"')";$(b).css("background-image",t);$(b).css("-webkit-background-size","cover");$(b).css("-moz-background-size","cover");$(b).css("background-size","cover");$(b).css("background-repeat","no-repeat");$(b).css("background-position","center center");$(b).css("background-attachment","scroll")}else{$(b).attr("src",s.response)}$(".imageFileTab").find("a.fileinput-exists").click();o=hasSandbox($(b));if(o){l=$(b).attr("id");$("#"+o).contents().find("#"+l).attr("src",s.response)}}else{if(s.code==0){alert("Something went wrong: "+s.response)}}}})}else{if($("a#img_Link").css("display")=="block"){if($("input#imageURL").val()!=""&&$("input#imageURL").val()!=$(b).attr("src")){$(b).attr("src",$("input#imageURL").val());o=hasSandbox($(b));if(o){l=$(b).attr("id");$("#"+o).contents().find("#"+l).attr("src",$("input#imageURL").val())}}}}if($(b).hasClass("fa")){var n=$.grep(b.className.split(" "),function(q,r){return q.indexOf("fa-")===0}).join();if(n!=$("select#icons").val()){$(b).uniqueId();_oldIcon[$(b).attr("id")]=n}$(b).removeClass(n).addClass($("select#icons").val());o=hasSandbox($(b));if(o){l=$(b).attr("id");$("#"+o).contents().find("#"+l).removeClass(n).addClass($("select#icons").val())}}if($(b).attr("data-type")=="video"){if($("input#youtubeID").val()!=""){$(b).prev().attr("src","//www.youtube.com/embed/"+$("#video_Tab input#youtubeID").val())}else{if($("input#vimeoID").val()!=""){$(b).prev().attr("src","//player.vimeo.com/video/"+$("#video_Tab input#vimeoID").val()+"?title=0&amp;byline=0&amp;portrait=0")}}o=hasSandbox($(b));if(o){l=$(b).attr("id");if($("input#youtubeID").val()!=""){$("#"+o).contents().find("#"+l).prev().attr("src","//www.youtube.com/embed/"+$("#video_Tab input#youtubeID").val())}else{if($("input#vimeoID").val()!=""){$("#"+o).contents().find("#"+l).prev().attr("src","//player.vimeo.com/video/"+$("#video_Tab input#vimeoID").val()+"?title=0&amp;byline=0&amp;portrait=0")}}}}$("#detailsAppliedMessage").fadeIn(600,function(){setTimeout(function(){$("#detailsAppliedMessage").fadeOut(1000)},3000)});heightAdjustment(b);setPendingChanges(true)});$("button#removeElementButton").unbind("click").bind("click",function(){var l;var k;if($(b).prop("tagName")=="A"){if($(b).parent().prop("tagName")=="LI"){l=$(b).parent()}else{l=$(b)}}else{if($(b).prop("tagName")=="IMG"){if($(b).parent().prop("tagName")=="A"){l=$(b).parent()}else{l=$(b)}}else{l=$(b)}}$("#styleEditor").on("click","button#removeElementButton",function(){$("#deleteElement").modal("show");$("#deleteElement button#deleteElementConfirm").unbind("click").bind("click",function(){l.fadeOut(500,function(){k=$(this).closest("body").find("*:first");l.remove();heightAdjustment(k[0])});$("#deleteElement").modal("hide");closeStyleEditor()})})});$("button#cloneElementButton").unbind("click").bind("click",function(){var l;var o;var k;var n;if($(b).parent().hasClass("propClone")){l=$(b).parent().clone();l.find($(b).prop("tagName")).attr("style","");o=l.find($(b).prop("tagName"));k=$(b).parent();n=$(b).parent().parent()}else{l=$(b).clone();l.attr("style","");o=l;k=$(b);n=$(b).parent()}k.after(l);for(var m in editableItems){$(b).closest("body").find(pageContainer+" "+m).each(function(){if($(this)[0]===$(o)[0]){o.hover(function(){if($(this).closest("body").width()!=$(this).width()){$(this).css({outline:"3px dashed red",cursor:"pointer"})}else{$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}},function(){if($(this).closest("body").width()!=($(this).width()+6)){$(this).css({outline:"",cursor:""})}else{$(this).css({outline:"",cursor:"","outline-offset":""})}}).click(function(p){p.preventDefault();p.stopPropagation();styleClick(this,m)}).each(function(){$(this).attr("data-selector",m)})}})}heightAdjustment(b)});$("button#resetStyleButton").unbind("click").bind("click",function(){if($(b).closest("body").width()!=$(b).width()){$(b).attr("style","").css({outline:"3px dashed red",cursor:"pointer"})}else{$(b).attr("style","").css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}$("#styleEditor form#stylingForm").height($("#styleEditor form#stylingForm").height()+"px");$("#styleEditor form#stylingForm .form-group:not(#styleElTemplate)").fadeOut(500,function(){$(this).remove()});if(_oldIcon[$(b).attr("id")]!=null){var k=$.grep(b.className.split(" "),function(l,m){return l.indexOf("fa-")===0}).join();$(b).removeClass(k).addClass(_oldIcon[$(b).attr("id")]);$("select#icons option").each(function(){if($(this).val()==_oldIcon[$(b).attr("id")]){$(this).attr("selected",true);$("#icons").trigger("chosen:updated")}})}setTimeout(function(){buildeStyleElements(b,j)},550)})}function closeStyleEditor(){if($("#styleEditor").css("left")=="0px"){$("#styleEditor").animate({left:"-300px"},250);$("#pageList ul li iframe").each(function(){for(var a in editableItems){$(this).contents().find(pageContainer+" "+a).unbind("mouseenter mouseleave click").css({outline:"",cursor:""})}if($("input:radio[name=mode]:checked").val()=="styling"){$("#pageList ul li iframe").each(function(){for(var b in editableItems){$(this).contents().find(pageContainer+" "+b).hover(function(c){c.stopPropagation();if($(this).closest("body").width()!=$(this).width()){$(this).css({outline:"3px dashed red",cursor:"pointer"})}else{$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}},function(){if($(this).closest("body").width()!=($(this).width()+6)){$(this).css({outline:"",cursor:""})}else{$(this).css({outline:"",cursor:"","outline-offset":""})}}).click(function(c){c.preventDefault();c.stopPropagation();styleClick(this,b)})}})}})}}$(function(){var d;$("input#youtubeID").focus(function(){$("input#vimeoID").val("")});$("input#vimeoID").focus(function(){$("input#youtubeID").val("")});$("select#icons").chosen({search_contains:true});d="server";if(window.location.protocol=="file:"){d="local"}if(!window.FormData){$("form#imageUploadForm").hide();$(".imageFileTab .or").hide()}$("select#internalLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"});$("select#internalLinksDropdown").change(function(){$("select#pageLinksDropdown option").attr("selected",false);$(".link_Tab .btn-group.select:eq(1) .dropdown-menu li").removeClass("selected");$(".link_Tab .btn-group.select:eq(1) > button .filter-option").text($(".link_Tab .btn-group.select:eq(1) .dropdown-menu li:first").text())});$("select#pageLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"});$("select#pageLinksDropdown").change(function(){$("select#internalLinksDropdown option").attr("selected",false);$(".link_Tab .btn-group.select:eq(0) .dropdown-menu li").removeClass("selected");$(".link_Tab .btn-group.select:eq(0) > button .filter-option").text($(".link_Tab .btn-group.select:eq(0) .dropdown-menu li:first").text())});$("input#internalLinksCustom").focus(function(){$("select#internalLinksDropdown option").attr("selected",false);$("select#pageLinksDropdown option").attr("selected",false);$(".link_Tab .dropdown-menu li").removeClass("selected");$(".link_Tab .btn-group.select > button .filter-option").text($(".link_Tab .dropdown-menu li:first").text());this.select()});$("#detailsAppliedMessageHide").click(function(){$(this).parent().fadeOut(500)});if(typeof editableItems==="undefined"){$("#modeStyle").parent().remove()}$("#closeStyling").click(function(){closeStyleEditor()});$("#styleEditor form").on("focus","input",function(){$(this).css("position","absolute");$(this).css("right","0px");$(this).animate({width:"100%"},500);$(this).focus(function(){this.select()})}).on("blur","input",function(){$(this).animate({width:"42%"},500,function(){$(this).css("position","relative");$(this).css("right","auto")})});$("#menu #second ul>li").each(function(){$(this).find("iframe").zoomer({zoom:0.25,width:270,height:$(this).attr("height"),message:"Перетащи меня!"});makeDraggable("#page1")});$("#menu").mouseenter(function(){$(this).stop().animate({left:"0px"},500)}).mouseleave(function(){$(this).stop().animate({left:"-190px"},500)});makeSortable($("#pageList ul#page1"));$("#menu #main #elements").on("click","a:not(.btn)",function(){$("#menu #main a").removeClass("active");$(this).addClass("active");$("#menu #second ul li").hide();$("#menu #second ul li."+$(this).attr("id")).show();if($(this).attr("id")=="all"){$("#menu #second ul li").show()}$(".menu .second").css("display","block").stop().animate({width:secondMenuWidth},500)});$("#menu").mouseleave(function(){$("#menu #main a").removeClass("active");$(".menu .second").stop().animate({width:0},500,function(){$("#menu #second").hide()})});$("#menu #main").on("click","a:not(.actionButtons)",function(f){f.preventDefault()});$("#menu").mouseleave(function(){$("#menu #main a").removeClass("active");$(".menu .second").stop().animate({width:0},500,function(){$("#menu #second").hide()})});$("#hideSecond").on("click",function(){$(".menu .second").stop().animate({width:0},500,function(){$("#menu #second").hide()})});$("input:radio[name=mode]").parent().addClass("disabled");$("input:radio[name=mode]#modeBlock").radio("check");var b;$("input:radio[name=mode]").on("toggle",function(){closeStyleEditor();$("#pageList ul .frameCover").each(function(){$(this).hide()});$("#pageList ul li iframe").each(function(){for(var f in editableItems){$(this).contents().find(pageContainer+" "+f).unbind("hover").unbind("click")}});if($(this).val()=="content"){$("#pageList ul li iframe").each(function(){for(var f=0;f<editableContent.length;++f){$(this).contents().find(pageContainer+" "+editableContent[f]).unbind("click").unbind("hover");$(this).contents().find(pageContainer+" "+editableContent[f]).hover(function(){$(this).css({outline:"3px dashed red",cursor:"pointer"})},function(){$(this).css({outline:"",cursor:""})}).click(function(g){b=$(this);g.preventDefault();g.stopPropagation();$("#editContentModal #contentToEdit").val($(this).html());$("#editContentModal").modal("show");if(this.tagName=="SMALL"||this.tagName=="A"||this.tagName=="LI"||this.tagName=="SPAN"||this.tagName=="B"||this.tagName=="I"||this.tagName=="TT"||this.tageName=="CODE"||this.tagName=="EM"||this.tagName=="STRONG"||this.tagName=="SUB"||this.tagName=="BUTTON"||this.tagName=="LABEL"||this.tagName=="P"||this.tagName=="H1"||this.tagName=="H2"||this.tagName=="H2"||this.tagName=="H3"||this.tagName=="H4"||this.tagName=="H5"||this.tagName=="H6"){$("#editContentModal #contentToEdit").redactor({buttons:["html","bold","italic","deleted"],focus:true,plugins:["bufferbuttons"],buttonSource:true,paragraphize:false,linebreaks:true})}else{if(this.tagName=="DIV"&&$(this).hasClass("tableWrapper")){$("#editContentModal #contentToEdit").redactor({buttons:["html","formatting","bold","italic","deleted","table","image","link","alignment"],focus:true,plugins:["table","bufferbuttons"],buttonSource:true,paragraphize:false,linebreaks:false})}else{$("#editContentModal #contentToEdit").redactor({buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","file","link","alignment","horizontalrule"],focus:true,buttonSource:true,paragraphize:false,linebreaks:false})}}}).each(function(){$(this).attr("data-selector",f)})}})}else{if($(this).val()=="block"){$("#pageList ul .frameCover").each(function(){$(this).show();$(this).css("height","100%")});$("#pageList ul li iframe").each(function(){for(var f in editableItems){$(this).contents().find(pageContainer+" "+f).unbind("mouseenter mouseleave")}this.contentDocument.designMode="off"})}else{if($(this).val()=="styling"){$("#pageList ul li iframe").each(function(){$(this).contents().find(pageContainer+" p").unbind("click").unbind("hover");for(var f in editableItems){$(this).contents().find(pageContainer+" "+f).hover(function(g){g.stopPropagation();if($(this).closest("body").width()!=$(this).width()){$(this).css({outline:"3px dashed red",cursor:"pointer"})}else{$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}},function(){$(this).css({outline:"",cursor:"","outline-offset":""})}).click(function(g){g.preventDefault();g.stopPropagation();styleClick(this,f)}).each(function(){$(this).attr("data-selector",f)})}})}}}});$("button#updateContentInFrameSubmit").click(function(){var f;b.html($("#editContentModal #contentToEdit").redactor("code.get")).css({outline:"",cursor:""});f=hasSandbox(b);if(f){elementID=b.attr("id");$("#"+f).contents().find("#"+elementID).html($("#editContentModal #contentToEdit").redactor("code.get"))}$("#editContentModal textarea").each(function(){$(this).redactor("core.destroy");$(this).val("")});$("#editContentModal").modal("hide");$(this).closest("body").removeClass("modal-open").attr("style","");heightAdjustment(b.get(0));setPendingChanges(true)});$("#styleEditor > a.close").click(function(f){f.preventDefault();closeStyleEditor()});var a;$("#pageList").on("click",".frameCover > .deleteBlock",function(){$("#deleteBlock").modal("show");a=$(this).closest("li");$("#deleteBlock").off("click","#deleteBlockConfirm").on("click","#deleteBlockConfirm",function(){var f=a.find("iframe").attr("data-sandbox");if(typeof f!==typeof undefined&&f!==false){$("#sandboxes #"+f).remove()}$("#deleteBlock").modal("hide");a.fadeOut(500,function(){$(this).remove();pageEmpty();allEmpty();setPendingChanges(true)})})});$("#pageList").on("click",".frameCover > .resetBlock",function(){$("#resetBlock").modal("show");var f=$(this).closest("li").find("iframe");$("#resetBlock").off("click","#resetBlockConfirm").on("click","#resetBlockConfirm",function(){$("#resetBlock").modal("hide");f.get(0).contentWindow.location.reload();var g=f.attr("data-sandbox");if(typeof g!==typeof undefined&&g!==false){document.getElementById(g).contentDocument.location.reload(true)}})});var e=[];$("#pageList").on("click",".frameCover > .htmlBlock",function(){$(this).closest(".li").find("iframe").hide();$(this).closest("li").parent().sortable("disable");var i=$('<div class="aceEditor"></div>');i.uniqueId();if($(this).closest("li").height()<300){$(this).closest("li").height(300);i.height(300)}else{i.height($(this).closest("li").height())}$(this).closest("li").append(i);var g=i.attr("id");var h=ace.edit(g);var f=$(this).closest("li").find("iframe").attr("data-sandbox");if(typeof f!==typeof undefined&&f!==false){h.setValue($("#sandboxes #"+f).contents().find(pageContainer).html());document.getElementById(f).contentDocument.location.reload(true)}else{h.setValue($(this).closest("li").find("iframe").contents().find(pageContainer).html())}h.setTheme("ace/theme/twilight");h.getSession().setMode("ace/mode/html");var l=$('<button type="button" class="btn btn-danger editCancelButton btn-wide"><span class="fui-cross"></span> Отмена</button>');var k=$('<button type="button" class="btn btn-primary editSaveButton btn-wide"><span class="fui-check"></span> Сохранить</button>');var j=$('<div class="editorButtons"></div>');j.append(l);j.append(k);$(this).closest("li").append(j);e[g]=h});$("#pageList").on("click","li .editorButtons .editCancelButton",function(){heightAdjustment($(this).closest("li").find("iframe").attr("id"),true);$(this).closest("li").parent().sortable("enable");$(this).parent().prev().remove();$(this).closest("li").find(".zoomer-small iframe").fadeIn(500);$(this).parent().fadeOut(500,function(){$(this).remove()})});$("#pageList").on("click","li .editorButtons .editSaveButton",function(){$(this).closest("li").parent().sortable("enable");var j=$(this).closest(".editorButtons").prev().attr("id");var h=e[j].getValue();var g=$(this).closest("li").find("iframe");$(this).parent().prev().remove();var f=$(this).closest("li").find("iframe").attr("data-sandbox");if(typeof f!==typeof undefined&&f!==false){$("#sandboxes #"+f).contents().find(pageContainer).html(h);$(this).closest("li").find("iframe").show().contents().find(pageContainer).html(h);if(typeof g.attr("data-loaderfunction")!==typeof undefined&&g.attr("data-loaderfunction")!==false){var i="theiFrame[0].contentWindow."+g.attr("data-loaderfunction")+"()";var k=new Function(i);k()}}else{$(this).closest("li").find("iframe").show().contents().find(pageContainer).html(h)}heightAdjustment($(this).closest("li").find("iframe").attr("id"),true);$(this).parent().fadeOut(500,function(){$(this).remove()});setPendingChanges(true)});$("#savePage").click(function(f){f.preventDefault();savePage(f)});$("#previewModal").on("show.bs.modal",function(f){$("#previewModal > form #showPreview").show("");$("#previewModal > form #previewCancel").text("Закрыть");closeStyleEditor()});$("#previewModal").on("shown.bs.modal",function(g){var h;var f;$('#previewModal form input[type="hidden"]').remove();$("#pageList > ul:visible").each(function(){h=$("iframe#skeleton").contents().find(pageContainer);h.find("*").remove();$(this).find("iframe").each(function(){var k=$(this).attr("data-sandbox");if(typeof k!==typeof undefined&&k!==false){f=$("#sandboxes #"+k).contents().find(pageContainer)}else{f=$(this).contents().find(pageContainer)}f.find(".frameCover").each(function(){$(this).remove()});for(var n in editableItems){f.find(n).each(function(){$(this).removeAttr("data-selector");if($(this).attr("style")==""){$(this).removeAttr("style")}})}for(var m=0;m<editableContent.length;++m){$(this).contents().find(editableContent[m]).each(function(){$(this).removeAttr("data-selector")})}var l=f.html();var j=$(this).contents().find(pageContainer).find("script");if(j.size()>0){var o=document.getElementById("skeleton");j.each(function(){if($(this).text()!=""){var p=o.contentWindow.document.createElement("script");p.type="text/javascript";p.innerHTML=$(this).text();o.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(p)}else{if($(this).attr("src")!=null){var p=o.contentWindow.document.createElement("script");p.type="text/javascript";p.src=$(this).attr("src");o.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(p)}}})}h.append($(l))});var i=$('<input type="hidden" name="page" value="">');$("#previewModal form").prepend(i);i.val("<html>"+$("iframe#skeleton").contents().find("html").html()+"</html>")})});$("#previewModal > form").submit(function(){$("#previewModal > form #showPreview").hide("");$("#previewModal > form #previewCancel").text("Закрыть")});$("#xsDgnInput").on("change",function(){var f=this.value.match(/\.(.+)$/)[1];if($.inArray(f,["xs"])==-1){var g="Please upload save Project file!";$("#xsErrorModal .modal-body").html(g);$("#xsErrorModal").modal("show")}else{$("#xsclearCanvas").modal("show");$("#xsImpModal").modal("hide")}});$("#xsclearCanvasImport").on("click",function(){$("#xsImportForm").submit()});$("#metaModal").on("show.bs.modal",function(f){$("#metaModal > form #exportSubmit").show("");$("#metaModal > form #exportCancel").text("Отменить и закрыть");closeStyleEditor()});$("#metaModal > form").on("submit",function(h){h.preventDefault();savePage(h);var g=$(this);var f=g.attr("action");$.ajax({url:f,data:g.serializeArray(),type:"POST"}).done(function(j,i,k){if(k.status==401){$("#auth .modal").modal("show")}else{console.log("Metas Saved")}}).fail(function(j,i,k){alert("Ошибка Metas")})});$("#metaModal").on("shown.bs.modal",function(g){$("#iconInput").on("click",function(h){h.preventDefault();$("#uploadIcon").click()});var f=$('<input type="hidden" name="alias_id" value="'+$("#selectAlias").val()+'">');$("#metaModal form").prepend(f);$("#uploadIcon").on("change",function(k){var j=$("form#uploadIconForm");var h=false;if(window.FormData){h=new FormData(j[0])}var i=j.attr("action");$.ajax({url:i,data:h?h:j.serialize(),cache:false,contentType:false,processData:false,dataType:"json",type:"POST"}).done(function(m,l){if(l==401){$("#auth.modal").modal("show")}else{$("#img_icon").attr("src",m.response);$("#export_icon").val(m.response)}}).fail(function(m,l){if(l==401){$("#auth.modal").modal("show")}})});$.ajax({url:"/builder/metas/"+$("#selectDomain").val(),dataType:"json",type:"GET"}).done(function(j,h,n){if(n.status==401){$("#metaModal").modal("hide");$("#auth .modal").modal("show")}else{for(var k=0;k<j.length;k++){if(j[k].name==="icon"){$("#img_"+j[k].name).attr("src",j[k].content)}$("#export_"+j[k].name).val(j[k].content)}var l=ace.edit("editorWidget");l.setTheme("ace/theme/twilight");l.getSession().setMode("ace/mode/html");l.getSession().setValue($("#export_widget").val());l.getSession().on("change",function(){$("#export_widget").val(l.getSession().getValue())});var m=ace.edit("editorStyle");m.setTheme("ace/theme/twilight");m.getSession().setMode("ace/mode/css");m.getSession().setValue($("#export_style").val());m.getSession().on("change",function(){$("#export_style").val(m.getSession().getValue())});$("#removeFavIcon").on("click",function(){$("#export_icon").val("");$("#img_icon").attr("src","/images/favicon.ico")})}}).fail(function(i,h,j){alert("Ошибка!")})});$("#metaModal > form").submit(function(){$("#metaModal").modal("hide")});$("#clearScreen").click(function(){$("#deleteAll").modal("show");$("#deleteAll").on("click","#deleteAllConfirm",function(){$("#deleteAll").modal("hide");$("#pageList ul:visible li").fadeOut(500,function(){$(this).remove();pageEmpty();allEmpty()});$("#sandboxes iframe").each(function(){$(this).remove()})});setPendingChanges(true)});$("#pages").on("blur","li > input",function(){if($(this).parent().find("a.plink").size()==0){theLink=$('<a href="#'+$(this).val()+'" class="plink">'+$(this).val()+"</a>");$(this).hide();$(this).closest("li").prepend(theLink);$(this).closest("li").removeClass("edit");$("#internalLinksDropdown option:eq("+$(this).parent().index()+")").text($(this).val()).attr("value",$(this).val()+".html");$("select#internalLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"});$(this).remove()}});$("#addPage").click(function(k){k.preventDefault();$("#pages li.active").each(function(){if($(this).find("input").size()>0){var l=$('<a href="#">'+$(this).find("input").val()+"</a>");$(this).find("input").remove();$(this).prepend(l)}});$("#pages li").removeClass("active");var g=$("#newPageLI").clone();g.css("display","block");g.find("input").val("page"+$("#pages li").size());g.attr("id","");$("ul#pages").append(g);var i=g.find("input");i.focus();var f=i.val();i.val("");i.val(f);i.keyup(function(){$("#pageTitle span span").text($(this).val())});g.addClass("active").addClass("edit");var j=$("<ul></ul>");j.css("display","block");j.attr("id","page"+($("#pages li").size()-1));$("#pageList > ul").hide();$("#pageList").append(j);makeSortable(j);makeDraggable("#page"+($("#pages li").size()-1));$("#pageTitle span span").text("page"+($("#pages li").size()-1));$("#frameWrapper").addClass("empty");$("#start").fadeIn();var h=$('<option value="page'+($("#pages li").size()-1)+'.html">page'+($("#pages li").size()-1)+"</option>");$("#internalLinksDropdown").append(h);$("select#internalLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"});setPendingChanges(true)});$("#pages").on("click","li:not(.active)",function(){$("#pageList > ul").hide();$("#pageList > ul:eq("+($(this).index()-1)+")").show();pageEmpty();makeDraggable("#page"+($(this).index()));$("#pages li").removeClass("active").removeClass("edit");$(this).addClass("active");$("#pageTitle span span").text($(this).find("a").text())});$("#pages").on("click","li.active .fileSave",function(){var f=$(this).closest("li");if(f.find("input").size()>0){var g=$('<a href="#'+f.find("input").val()+'">'+f.find("input").val()+"</a>");f.find("input").remove();f.prepend(g)}$("#pages li").removeClass("edit")});$("#pages").on("click","li.active .fileEdit",function(){var h=$(this).closest("li");var g=$('<input type="text" value="'+h.find("a:first").text()+'" name="page">');h.find("a:first").remove();h.prepend(g);g.focus();var f=g.val();g.val("");g.val(f);g.keyup(function(){$("#pageTitle span span").text($(this).val())});h.addClass("edit");setPendingChanges(true)});var c;$("#pages").on("click","li.active .fileDel",function(){c=$(this).parent().parent().index();$("#deletePage").modal("show");$("#deletePageCancel").click(function(){$("#deletePage").modal("hide")});$("#deletePage").off("click").on("click","#deletePageConfirm",function(f){$("#deletePage").modal("hide");$("#pages li:eq("+c+")").remove();$("#pageList ul:visible").remove();$("select#internalLinksDropdown option:eq("+c+")").remove();$(".link_Tab .dropdown-menu li:eq("+c+")").remove();$("#pages li:eq(1)").addClass("active");$("#pageList ul:first").show();$("#pageTitle span span").text($("#pages li:eq(1)").find("a:first").text());makeDraggable("#page1");pageEmpty();allEmpty();savePage(f);setPendingChanges(true)})});$("#editContentModal").on("hidden.bs.modal",function(f){$("#editContentModal #contentToEdit").redactor("core.destroy")})});function savePage(f){var g=[];closeStyleEditor();var a=0;$("#pageList > ul").each(function(){g[a]={element:[],frame:[],page:[]};var e=$(this).attr("id");var c="";$(this).find("li").each(function(){g[a].frame.push($(this).html())});$(this).find("iframe").each(function(){var j=$(this).attr("data-sandbox");if(typeof j!==typeof undefined&&j!==false){c=$("#sandboxes #"+j).contents().find(pageContainer)}else{c=$(this).contents().find(pageContainer)}c.find(".frameCover").each(function(){$(this).remove()});for(var l in editableItems){c.find(l).each(function(){$(this).removeAttr("data-selector");if($(this).attr("style")==""){$(this).removeAttr("style")}})}for(var k=0;k<editableContent.length;++k){$(this).contents().find(editableContent[k]).each(function(){$(this).removeAttr("data-selector")})}g[a].element.push(c.html())});a++});var h=0;$("ul#pages li:not(#newPageLI)").each(function(c){g[h].page=$(this).find("a").text();h++});var d=$("#savePageForm");var b=d.attr("action");$.ajax({url:b,data:JSON.stringify({domain_id:$("#selectDomain").val(),blocks:g}),cache:false,contentType:false,processData:false,dataType:"json",type:"POST"}).done(function(e,c,i){if(i.status==401){$("#auth .modal").modal("show")}else{setPendingChanges(false)}}).fail(function(e,c,i){$("#auth .modal").modal("show")})};