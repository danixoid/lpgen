function rgb2hex(e){return e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+hex(e[1])+hex(e[2])+hex(e[3])}function hex(e){return isNaN(e)?"00":hexDigits[(e-e%16)/16]+hexDigits[e%16]}function getRandomArbitrary(e,t){return Math.floor(Math.random()*(t-e)+e)}function setPendingChanges(e){1==e?($("#savePage .bLabel").text("Сохранить изменения (!)"),pendingChanges=!0):($("#savePage .bLabel").text("Сохранено"),pendingChanges=!1)}function pageEmpty(){0==$("#pageList ul:visible > li").size()?($("#start").show(),$("#frameWrapper").addClass("empty")):($("#start").hide(),$("#frameWrapper").removeClass("empty"))}function allEmpty(){var e=!1;e=0==$("#pageList li").size(),e?($("a.actionButtons").each(function(){$(this).addClass("disabled")}),$("header .modes input").each(function(){$(this).prop("disabled",!0).parent().addClass("disabled")})):($("header .modes input").each(function(){$(this).prop("disabled",!1).parent().removeClass("disabled")}),$("a.actionButtons").each(function(){$(this).removeClass("disabled")}))}function makeDraggable(e){$("#second #elements li").each(function(){$(this).draggable({helper:function(){return $('<div style="height: 100px; width: 300px; background: #F9FAFA; box-shadow: 5px 5px 1px rgba(0,0,0,0.1); text-align: center; line-height: 100px; font-size: 28px; color: #16A085"><span class="fui-list"></span></div>')},revert:"invalid",appendTo:"body",connectToSortable:e,stop:function(){pageEmpty(),allEmpty()},start:function(){$("input:radio[name=mode]").parent().addClass("disabled"),$("input:radio[name=mode]#modeBlock").radio("check"),$("#pageList ul .zoomer-wrapper .zoomer-cover").each(function(){$(this).show()}),$("#pageList ul li iframe").each(function(){this.contentDocument.designMode="off"})}})}),$("#elements li a").each(function(){$(this).unbind("click").bind("click",function(e){e.preventDefault()})})}function makeSortable(e){e.sortable({revert:!0,placeholder:"drop-hover",handle:".frameCover",beforeStop:function(e,t){if(0==t.item.find(".frameCover").size()){if(t.item.find("iframe").size()>0){theHeight=t.item.height();var n=t.item.find("iframe").attr("data-sandbox");"undefined"!=typeof n&&n!==!1?(theID=getRandomArbitrary(1e4,1e9),sandboxedFrame=$('<iframe src="'+t.item.find("iframe").attr("src")+'" id="'+theID+'" sandbox="allow-same-origin"></iframe>'),$("#sandboxes").append(sandboxedFrame),"undefined"!=typeof t.item.find("iframe").attr("data-loaderfunction")&&t.item.find("iframe").attr("data-loaderfunction")!==!1&&(loaderFunction_='data-loaderfunction="'+t.item.find("iframe").attr("data-loaderfunction")+'"'),t.item.html('<iframe src="'+t.item.find("iframe").attr("src")+'" scrolling="no" frameborder="0" data-sandbox="'+theID+'" '+loaderFunction_+"><iframe>")):t.item.html('<iframe src="'+t.item.find("iframe").attr("src")+'" scrolling="no" frameborder="0"><iframe>'),t.item.find("iframe").uniqueId(),t.item.find("iframe").height(theHeight+"px")}else{theHeight=t.item.find("img").attr("data-height");var n=t.item.find("img").attr("data-sandbox");"undefined"!=typeof n&&n!==!1?(theID=getRandomArbitrary(1e4,1e9),sandboxedFrame=$('<iframe src="'+t.item.find("img").attr("data-srcc")+'" id="'+theID+'" sandbox="allow-same-origin"></iframe>'),$("#sandboxes").append(sandboxedFrame),"undefined"!=typeof t.item.find("img").attr("data-loaderfunction")&&t.item.find("img").attr("data-loaderfunction")!==!1&&(loaderFunction_='data-loaderfunction="'+t.item.find("img").attr("data-loaderfunction")+'"'),t.item.html('<iframe src="'+t.item.find("img").attr("data-srcc")+'" scrolling="no" frameborder="0" data-sandbox="'+theID+'" '+loaderFunction_+"><iframe>")):t.item.html('<iframe src="'+t.item.find("img").attr("data-srcc")+'" scrolling="no" frameborder="0"><iframe>'),t.item.find("iframe").uniqueId(),t.item.find("iframe").height(theHeight+"px"),t.item.find("iframe").css("background","#ffffff url(images/loading.gif) 50% 50% no-repeat"),t.item.find("iframe").load(function(){heightAdjustment(t.item.find("iframe").attr("id"),!0)})}delButton=$('<button type="button" class="btn btn-danger deleteBlock"><span class="fui-trash"></span> Удалить</button>'),resetButton=$('<button type="button" class="btn btn-warning resetBlock"><i class="fa fa-refresh"></i> Сброс</button>'),htmlButton=$('<button type="button" class="btn btn-inverse htmlBlock"><i class="fa fa-code"></i> Код</button>'),frameCover=$('<div class="frameCover"></div>'),frameCover.append(delButton),frameCover.append(resetButton),frameCover.append(htmlButton),t.item.append(frameCover)}else t.item.find("iframe").load(function(){$(this).contents().find(pageContainer).html(frameContents)});setPendingChanges(!0)},stop:function(){$("#pageList ul:visible li").each(function(){$(this).find(".zoomer-cover > a").remove()})},start:function(e,t){0!=t.item.find(".frameCover").size()&&(frameContents=t.item.find("iframe").contents().find(pageContainer).html())},over:function(){$("#start").hide()}})}function buildeStyleElements(e,t){for(console.log(t),x=0;x<editableItems[t].length;x++){if(newStyleEl=$("#styleElTemplate").clone(),newStyleEl.attr("id",""),newStyleEl.find(".control-label").text(editableItems[t][x]+":"),t+" : "+editableItems[t][x]in editableItemOptions){for(newStyleEl.find("input").remove(),newDropDown=$("<select></select>"),newDropDown.attr("name",editableItems[t][x]),z=0;z<editableItemOptions[t+" : "+editableItems[t][x]].length;z++)newOption=$('<option value="'+editableItemOptions[t+" : "+editableItems[t][x]][z]+'">'+editableItemOptions[t+" : "+editableItems[t][x]][z]+"</option>"),editableItemOptions[t+" : "+editableItems[t][x]][z]==$(e).css(editableItems[t][x])&&newOption.attr("selected","true"),newDropDown.append(newOption);newStyleEl.append(newDropDown),newDropDown.selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"})}else newStyleEl.find("input").val($(e).css(editableItems[t][x])).attr("name",editableItems[t][x]),editableItems[t][x].indexOf("color")>-1&&("transparent"!=$(e).css(editableItems[t][x])&&"none"!=$(e).css(editableItems[t][x])&&""!=$(e).css(editableItems[t][x])&&newStyleEl.val($(e).css(editableItems[t][x])),newStyleEl.find("input").spectrum({preferredFormat:"hex",showPalette:!0,allowEmpty:!0,showInput:!0,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]]}));newStyleEl.css("display","block"),$("#styleElements").append(newStyleEl),$("#styleEditor form#stylingForm").height("auto")}}function getParentFrameID(e){if(theID="",$("#pageList li:visible iframe").each(function(){theBody=$(this).contents().find("body"),$.contains(document.getElementById($(this).attr("id")).contentWindow.document,e)&&(theID=$(this).attr("id"))}),""!=theID)return theID}function heightAdjustment(e,t){t="undefined"!=typeof t&&t,0==t?($("#pageList li:visible iframe").each(function(){theBody=$(this).contents().find("body"),$.contains(document.getElementById($(this).attr("id")).contentWindow.document,e)&&(frameID=$(this).attr("id"))}),theFrame=document.getElementById(frameID)):theFrame=document.getElementById(e),realHeight=theFrame.contentWindow.document.body.offsetHeight,$(theFrame).height(realHeight+"px"),$(theFrame).parent().height(realHeight+"px"),$(theFrame).next().height(realHeight+"px")}function hasSandbox(e){var t=$("#"+getParentFrameID(e.get(0))).attr("data-sandbox");return"undefined"!=typeof t&&t!==!1&&t}function styleClick(e){if(theSelector=$(e).attr("data-selector"),$("#editingElement").text(theSelector),$("#detailTabs a:first").click(),$("a#link_Link").parent().hide(),$("a#img_Link").parent().hide(),$("a#icon_Link").parent().hide(),$("a#video_Link").parent().hide(),"A"!=$(e).prop("tagName")&&"A"!=$(e).parent().prop("tagName")||($("a#link_Link").parent().show(),"A"==$(e).prop("tagName")?theHref=$(e).attr("href"):"A"==$(e).parent().prop("tagName")&&(theHref=$(e).parent().attr("href")),zIndex=0,pageLink=!1,$("select#internalLinksDropdown").prop("selectedIndex",0),$("select#internalLinksDropdown option").each(function(){$(this).attr("value")==theHref&&($(this).attr("selected",!0),zIndex=$(this).index(),pageLink=!0)}),$(".link_Tab .btn-group.select .dropdown-menu li").removeClass("selected"),$(".link_Tab .btn-group.select .dropdown-menu li:eq("+zIndex+")").addClass("selected"),$(".link_Tab .btn-group.select:eq(0) .filter-option").text($("select#internalLinksDropdown option:selected").text()),$(".link_Tab .btn-group.select:eq(1) .filter-option").text($("select#pageLinksDropdown option:selected").text()),1==pageLink?$("input#internalLinksCustom").val(""):"A"==$(e).prop("tagName")?"#"!=$(e).attr("href")[0]?$("input#internalLinksCustom").val($(e).attr("href")):$("input#internalLinksCustom").val(""):"A"==$(e).parent().prop("tagName")&&("#"!=$(e).parent().attr("href")[0]?$("input#internalLinksCustom").val($(e).parent().attr("href")):$("input#internalLinksCustom").val("")),$("select#pageLinksDropdown option:not(:first)").remove(),$("#pageList ul:visible iframe").each(function(){void 0!=$(this).contents().find(pageContainer+" > *:first").attr("id")&&($(e).attr("href")=="#"+$(this).contents().find(pageContainer+" > *:first").attr("id")?newOption="<option selected value=#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+">#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+"</option>":newOption="<option value=#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+">#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+"</option>",$("select#pageLinksDropdown").append(newOption))})),"video"==$(e).attr("data-type"))if($("a#video_Link").parent().show(),$("a#video_Link").click(),$(e).prev().attr("src").indexOf("vimeo.com")>-1)n=$(e).prev().attr("src").match(/player\.vimeo\.com\/video\/([0-9]*)/),$("#video_Tab input#vimeoID").val(n[n.length-1]),$("#video_Tab input#youtubeID").val("");else{var t=/.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/,n=$(e).prev().attr("src").match(t);$("#video_Tab input#youtubeID").val(n[1]),$("#video_Tab input#vimeoID").val("")}if("IMG"==$(e).prop("tagName")&&($("a#img_Link").parent().show(),$(".imageFileTab").find("input#imageURL").val($(e).attr("src")),$(".imageFileTab").find("a.fileinput-exists").click()),$(e).hasClass("bg-img")&&$("a#img_Link").parent().show(),$(e).hasClass("fa")){$("a#icon_Link").parent().show();var i=$.grep(e.className.split(" "),function(e,t){return 0===e.indexOf("fa-")}).join();$("select#icons option").each(function(){$(this).val()==i&&($(this).attr("selected",!0),$("#icons").trigger("chosen:updated"))})}$("#pageList ul:visible li iframe").each(function(){for(var e in editableItems)$(this).contents().find(pageContainer+" "+e).css({outline:"none",cursor:"default"}),$(this).contents().find(pageContainer+" "+e).hover(function(e){e.stopPropagation(),$(this).closest("body").width()!=$(this).width()?$(this).css({outline:"3px dashed red",cursor:"pointer"}):$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})},function(){$(this).closest("body").width()!=$(this).width()+6?$(this).css({outline:"",cursor:""}):$(this).css({border:"",cursor:"","outline-offset":""})})}),$(e).unbind("mouseenter mouseleave"),$(e).closest("body").width()!=$(e).width()?$(e).css({outline:"3px dashed red",cursor:"pointer"}):$(e).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"}),$("#styleElements > *:not(#styleElTemplate)").each(function(){$(this).remove()}),buildeStyleElements(e,theSelector),"-300px"==$("#styleEditor").css("left")&&$("#styleEditor").animate({left:"0px"},250),$("button#saveStyling").unbind("click").bind("click",function(){if($("#styleEditor #tab1 .form-group:not(#styleElTemplate) input, #styleEditor #tab1 .form-group:not(#styleElTemplate) select").each(function(){$(e).css($(this).attr("name"),$(this).val()),sandboxID=hasSandbox($(e)),sandboxID&&(elementID=$(e).attr("id"),$("#"+sandboxID).contents().find("#"+elementID).css($(this).attr("name"),$(this).val()))}),"A"==$(e).prop("tagName")&&("#"!=$("select#internalLinksDropdown").val()?$(e).attr("href",$("select#internalLinksDropdown").val()):"#"!=$("select#pageLinksDropdown").val()?$(e).attr("href",$("select#pageLinksDropdown").val()):""!=$("input#internalLinksCustom").val()&&$(e).attr("href",$("input#internalLinksCustom").val()),sandboxID=hasSandbox($(e)),sandboxID&&(elementID=$(e).attr("id"),"#"!=$("select#internalLinksDropdown").val()?$("#"+sandboxID).contents().find("#"+elementID).attr("href",$("select#internalLinksDropdown").val()):"#"!=$("select#pageLinksDropdown").val()?$("#"+sandboxID).contents().find("#"+elementID).attr("href",$("select#pageLinksDropdown").val()):""!=$("input#internalLinksCustom").val()&&$("#"+sandboxID).contents().find("#"+elementID).attr("href",$("input#internalLinksCustom").val()))),"A"==$(e).parent().prop("tagName")&&("#"!=$("select#internalLinksDropdown").val()?$(e).parent().attr("href",$("select#internalLinksDropdown").val()):"#"!=$("select#pageLinksDropdown").val()?$(e).parent().attr("href",$("select#pageLinksDropdown").val()):""!=$("input#internalLinksCustom").val()&&$(e).parent().attr("href",$("input#internalLinksCustom").val()),sandboxID=hasSandbox($(e)),sandboxID&&(elementID=$(e).attr("id"),"#"!=$("select#internalLinksDropdown").val()?$("#"+sandboxID).contents().find("#"+elementID).parent().attr("href",$("select#internalLinksDropdown").val()):"#"!=$("select#pageLinksDropdown").val()?$("#"+sandboxID).contents().find("#"+elementID).parent().attr("href",$("select#pageLinksDropdown").val()):""!=$("input#internalLinksCustom").val()&&$("#"+sandboxID).contents().find("#"+elementID).parent().attr("href",$("input#internalLinksCustom").val()))),"block"==$("a#img_Link").css("display")&&""!=$("input#imageFileField").val()){var t=$("form#imageUploadForm"),n=!1;window.FormData&&(n=new FormData(t[0]));var i=t.attr("action");$.ajax({url:i,data:n?n:t.serialize(),cache:!1,contentType:!1,processData:!1,dataType:"json",type:"POST"}).done(function(t){if(1==t.code){if($("input#imageURL").val(t.response),$(e).hasClass("bg-img")){var n="url('"+t.response+"')";$(e).css("background-image",n),$(e).css("-webkit-background-size","cover"),$(e).css("-moz-background-size","cover"),$(e).css("background-size","cover"),$(e).css("background-repeat","no-repeat"),$(e).css("background-position","center center"),$(e).css("background-attachment","scroll")}else $(e).attr("src",t.response);$(".imageFileTab").find("a.fileinput-exists").click(),sandboxID=hasSandbox($(e)),sandboxID&&(elementID=$(e).attr("id"),$("#"+sandboxID).contents().find("#"+elementID).attr("src",t.response))}else 0==t.code&&alert("Something went wrong: "+t.response)})}else"block"==$("a#img_Link").css("display")&&""!=$("input#imageURL").val()&&$("input#imageURL").val()!=$(e).attr("src")&&($(e).attr("src",$("input#imageURL").val()),sandboxID=hasSandbox($(e)),sandboxID&&(elementID=$(e).attr("id"),$("#"+sandboxID).contents().find("#"+elementID).attr("src",$("input#imageURL").val())));if($(e).hasClass("fa")){var a=$.grep(e.className.split(" "),function(e,t){return 0===e.indexOf("fa-")}).join();a!=$("select#icons").val()&&($(e).uniqueId(),_oldIcon[$(e).attr("id")]=a),$(e).removeClass(a).addClass($("select#icons").val()),sandboxID=hasSandbox($(e)),sandboxID&&(elementID=$(e).attr("id"),$("#"+sandboxID).contents().find("#"+elementID).removeClass(a).addClass($("select#icons").val()))}"video"==$(e).attr("data-type")&&(""!=$("input#youtubeID").val()?$(e).prev().attr("src","//www.youtube.com/embed/"+$("#video_Tab input#youtubeID").val()):""!=$("input#vimeoID").val()&&$(e).prev().attr("src","//player.vimeo.com/video/"+$("#video_Tab input#vimeoID").val()+"?title=0&amp;byline=0&amp;portrait=0"),sandboxID=hasSandbox($(e)),sandboxID&&(elementID=$(e).attr("id"),""!=$("input#youtubeID").val()?$("#"+sandboxID).contents().find("#"+elementID).prev().attr("src","//www.youtube.com/embed/"+$("#video_Tab input#youtubeID").val()):""!=$("input#vimeoID").val()&&$("#"+sandboxID).contents().find("#"+elementID).prev().attr("src","//player.vimeo.com/video/"+$("#video_Tab input#vimeoID").val()+"?title=0&amp;byline=0&amp;portrait=0"))),$("#detailsAppliedMessage").fadeIn(600,function(){setTimeout(function(){$("#detailsAppliedMessage").fadeOut(1e3)},3e3)}),heightAdjustment(e),setPendingChanges(!0)}),$("button#removeElementButton").unbind("click").bind("click",function(){"A"==$(e).prop("tagName")?"LI"==$(e).parent().prop("tagName")?toDel=$(e).parent():toDel=$(e):"IMG"==$(e).prop("tagName")&&"A"==$(e).parent().prop("tagName")?toDel=$(e).parent():toDel=$(e),$("#styleEditor").on("click","button#removeElementButton",function(){$("#deleteElement").modal("show"),$("#deleteElement button#deleteElementConfirm").unbind("click").bind("click",function(){toDel.fadeOut(500,function(){randomEl=$(this).closest("body").find("*:first"),toDel.remove(),heightAdjustment(randomEl[0])}),$("#deleteElement").modal("hide"),closeStyleEditor()})})}),$("button#cloneElementButton").unbind("click").bind("click",function(){$(e).parent().hasClass("propClone")?(theClone=$(e).parent().clone(),theClone.find($(e).prop("tagName")).attr("style",""),theOne=theClone.find($(e).prop("tagName")),cloned=$(e).parent(),cloneParent=$(e).parent().parent()):(theClone=$(e).clone(),theClone.attr("style",""),theOne=theClone,cloned=$(e),cloneParent=$(e).parent()),cloned.after(theClone);for(var t in editableItems)$(e).closest("body").find(pageContainer+" "+t).each(function(){$(this)[0]===$(theOne)[0]&&theOne.hover(function(){$(this).closest("body").width()!=$(this).width()?$(this).css({outline:"3px dashed red",cursor:"pointer"}):$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})},function(){$(this).closest("body").width()!=$(this).width()+6?$(this).css({outline:"",cursor:""}):$(this).css({outline:"",cursor:"","outline-offset":""})}).click(function(e){e.preventDefault(),e.stopPropagation(),styleClick(this,t)}).each(function(){$(this).attr("data-selector",t)})});heightAdjustment(e)}),$("button#resetStyleButton").unbind("click").bind("click",function(){if($(e).closest("body").width()!=$(e).width()?$(e).attr("style","").css({outline:"3px dashed red",cursor:"pointer"}):$(e).attr("style","").css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"}),$("#styleEditor form#stylingForm").height($("#styleEditor form#stylingForm").height()+"px"),$("#styleEditor form#stylingForm .form-group:not(#styleElTemplate)").fadeOut(500,function(){$(this).remove()}),null!=_oldIcon[$(e).attr("id")]){var t=$.grep(e.className.split(" "),function(e,t){return 0===e.indexOf("fa-")}).join();$(e).removeClass(t).addClass(_oldIcon[$(e).attr("id")]),$("select#icons option").each(function(){$(this).val()==_oldIcon[$(e).attr("id")]&&($(this).attr("selected",!0),$("#icons").trigger("chosen:updated"))})}setTimeout(function(){buildeStyleElements(e,theSelector)},550)})}function closeStyleEditor(){"0px"==$("#styleEditor").css("left")&&($("#styleEditor").animate({left:"-300px"},250),$("#pageList ul li iframe").each(function(){for(var e in editableItems)$(this).contents().find(pageContainer+" "+e).unbind("mouseenter mouseleave click").css({outline:"",cursor:""});"styling"==$("input:radio[name=mode]:checked").val()&&$("#pageList ul li iframe").each(function(){for(var e in editableItems)$(this).contents().find(pageContainer+" "+e).hover(function(e){e.stopPropagation(),$(this).closest("body").width()!=$(this).width()?$(this).css({outline:"3px dashed red",cursor:"pointer"}):$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})},function(){$(this).closest("body").width()!=$(this).width()+6?$(this).css({outline:"",cursor:""}):$(this).css({outline:"",cursor:"","outline-offset":""})}).click(function(t){t.preventDefault(),t.stopPropagation(),styleClick(this,e)})})}))}function savePage(e){var t=[];closeStyleEditor(),pageCounter=0,$("#pageList > ul").each(function(){t[pageCounter]={element:[],frame:[],page:""},theName=$(this).attr("id"),$(this).find("li").each(function(){t[pageCounter].frame.push($(this).html())}),$(this).find("iframe").each(function(){var e=$(this).attr("data-sandbox");"undefined"!=typeof e&&e!==!1?theContents=$("#sandboxes #"+e).contents().find(pageContainer):theContents=$(this).contents().find(pageContainer),theContents.find(".frameCover").each(function(){$(this).remove()});for(var n in editableItems)theContents.find(n).each(function(){$(this).removeAttr("data-selector"),""==$(this).attr("style")&&$(this).removeAttr("style")});for(i=0;i<editableContent.length;++i)$(this).contents().find(editableContent[i]).each(function(){$(this).removeAttr("data-selector")});t[pageCounter].element.push(theContents.html())}),pageCounter++}),c=0,$("ul#pages li:not(#newPageLI)").each(function(e){t[c].page=$(this).find("a").text(),c++}),console.log(t);var n=$("#savePageForm"),a=n.attr("action");$.ajax({url:a,data:JSON.stringify({blocks:t}),cache:!1,contentType:!1,processData:!1,dataType:"json",type:"POST"}).done(function(e){setPendingChanges(!1)})}var pageContainer="#page",enablePreview=!0,editableItems=new Array;editableItems[".frameCover"]=[],editableItems["nav#main-navbar"]=["background-color","box-shadow"],editableItems["nav a"]=["font-weight","font-size","text-transform"],editableItems["nav a.btn-nav"]=["font-weight","font-size","background-color"],editableItems[".nav-callus"]=["color","font-weight","font-size","text-transform"],editableItems["a.edit"]=["color","font-weight","font-size","text-transform"],editableItems[".text-edit"]=["color","font-weight","font-size","text-transform","background-color"],editableItems.img=["border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius","border-color","border-style","border-width"],editableItems[".bg-img"]=["background-color"],editableItems.h1=["color","font-size","background-color","font-family","font-weight"],editableItems.h2=["color","font-size","background-color","font-family","font-weight"],editableItems.h3=["color","font-size","background-color","font-family","font-weight"],editableItems.h4=["color","font-size","background-color","font-family","font-weight"],editableItems.h5=["color","font-size","background-color","font-family","font-weight"],editableItems.h6=["color","font-size","background-color","font-family","font-weight"],editableItems.p=["color","font-size","background-color","font-family","font-weight"],editableItems["a.btn, button.btn, .btn"]=["border-radius","font-size","background-color","box-shadow","border-color","border-style","border-width"],editableItems[".bg-edit"]=["background-color"],editableItems[".block-edit"]=["background-image"],editableItems["i, span.fa"]=["color","font-size"];var editableItemOptions=new Array;editableItemOptions["nav a : font-weight"]=["700","300","400","900"],editableItemOptions["nav a.btn-nav : font-weight"]=["700","300","400","900"],editableItemOptions["img : border-style"]=["none","dotted","dashed","solid"],editableItemOptions["img : border-width"]=["1px","2px","3px","4px"],editableItemOptions["h1 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"],editableItemOptions["h2 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"],editableItemOptions["h3 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"],editableItemOptions["h4 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"],editableItemOptions["h5 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"],editableItemOptions["h6 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"],editableItemOptions["p : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];var editableContent=[".editContent",".navbar a","a.edit","h1:not(.no-edit)","h2:not(.no-edit)","h3:not(.no-edit)","h4:not(.no-edit)","h5:not(.no-edit)","h6:not(.no-edit)","p:not(.no-edit)",".nav-callus",".text-edit",".btn:not(.no-edit)",".footer a:not(.fa)",".tableWrapper"];$(function(){$(".nav-tabs a").on("click",function(e){e.preventDefault(),$(this).tab("show")})});var mainMenuWidth=230,secondMenuWidth=300;$(window).load(function(){$("#loader").fadeOut(function(){$("#menu").animate({left:"-190px"},1e3)}),1==enablePreview&&$("#preview").show();var e=$("#getBlocksForm"),t=e.attr("action"),n=e.attr("method");$.ajax({url:t,cache:!1,contentType:!1,processData:!1,dataType:"json",type:n}).done(function(e){e.length>0&&$("#start").hide();var t=[];for(x=0;x<e.length;x++){var n=x+1;0==$("ul#page"+n).size()&&(newUL=$('<ul id="page'+n+'"></ul>'),$("#pageList").append(newUL),makeSortable(newUL),newItem=$('<option value="/'+e[x].name+'">'+e[x].name+"</option>"),$("#internalLinksDropdown").append(newItem));for(var i=0;i<e[x].l_blocks.length;i++)if(null!=e[x].l_blocks[i]){toInsert=$("<li>"+e[x].l_blocks[i].frame+"</li>"),toInsert.find("iframe").attr("id","ui-id-"+x+i),toInsert.find(".frameCover").show();var a=toInsert.find("iframe").attr("data-sandbox");"undefined"!=typeof a&&a!==!1&&(theiFrame=toInsert.find("iframe"),theID=theiFrame.attr("data-sandbox"),sandboxedFrame=$('<iframe src="'+theiFrame.attr("src")+'" id="'+theID+'" sandbox="allow-same-origin"></iframe>'),$("#sandboxes").append(sandboxedFrame)),t[toInsert.find("iframe").attr("id")]=e[x].l_blocks[i].element,toInsert.find("iframe").load(function(){$(this).contents().find(pageContainer).html(t[$(this).attr("id")]);var e=$(this).attr("data-sandbox");if("undefined"!=typeof e&&e!==!1){$("iframe#"+$(this).attr("data-sandbox")).contents().find(pageContainer).html(t[$(this).attr("id")]),theLoaderFunction=$(this).data("data-loaderfunction"),theiFrame=$(this);var n="theiFrame[0].contentWindow."+theiFrame.attr("data-loaderfunction")+"()",i=new Function(n);i()}}),$("ul#page"+n).append(toInsert)}x>=1&&"undefined"!=typeof e[x].name&&(newLI=$('<li><a class="plink" href="#'+e[x].name+'">'+e[x].name+'</a><span class="pageButtons"><a class="fileEdit" href=""><span class="fui-new"></span></a><a class="fileDel" href=""><span class="fui-cross"></span></a><a href="#" class="btn btn-xs btn-primary btn-embossed fileSave"><span class="fui-check"></span></a></span></li>'),$("ul#pages").append(newLI))}allEmpty()}),$(window).bind("beforeunload",function(){return">>>>>Before You Go<<<<<<<< \n Your custom message go here"})});var hexDigits=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),pendingChanges=!1,frameContents="",_oldIcon=new Array;$(function(){$("input#youtubeID").focus(function(){$("input#vimeoID").val("")}),$("input#vimeoID").focus(function(){$("input#youtubeID").val("")}),$("select#icons").chosen({search_contains:!0}),"file:"==window.location.protocol?_mode="local":_mode="server",window.FormData||($("form#imageUploadForm").hide(),$(".imageFileTab .or").hide()),$("select#internalLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"}),$("select#internalLinksDropdown").change(function(){$("select#pageLinksDropdown option").attr("selected",!1),$(".link_Tab .btn-group.select:eq(1) .dropdown-menu li").removeClass("selected"),$(".link_Tab .btn-group.select:eq(1) > button .filter-option").text($(".link_Tab .btn-group.select:eq(1) .dropdown-menu li:first").text())}),$("select#pageLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"}),$("select#pageLinksDropdown").change(function(){$("select#internalLinksDropdown option").attr("selected",!1),$(".link_Tab .btn-group.select:eq(0) .dropdown-menu li").removeClass("selected"),$(".link_Tab .btn-group.select:eq(0) > button .filter-option").text($(".link_Tab .btn-group.select:eq(0) .dropdown-menu li:first").text())}),$("input#internalLinksCustom").focus(function(){$("select#internalLinksDropdown option").attr("selected",!1),$("select#pageLinksDropdown option").attr("selected",!1),$(".link_Tab .dropdown-menu li").removeClass("selected"),$(".link_Tab .btn-group.select > button .filter-option").text($(".link_Tab .dropdown-menu li:first").text()),this.select()}),$("#detailsAppliedMessageHide").click(function(){$(this).parent().fadeOut(500)}),"undefined"==typeof editableItems&&$("#modeStyle").parent().remove(),$("#closeStyling").click(function(){closeStyleEditor()}),$("#styleEditor form").on("focus","input",function(){$(this).css("position","absolute"),$(this).css("right","0px"),$(this).animate({width:"100%"},500),$(this).focus(function(){this.select()})}).on("blur","input",function(){$(this).animate({width:"42%"},500,function(){$(this).css("position","relative"),$(this).css("right","auto")})}),$("#menu #second ul>li").each(function(){$(this).find("iframe").zoomer({zoom:.25,width:270,height:$(this).attr("height"),message:"Перетащи меня!"}),makeDraggable("#page1")}),$("#menu").mouseenter(function(){$(this).stop().animate({left:"0px"},500)}).mouseleave(function(){$(this).stop().animate({left:"-190px"},500)}),makeSortable($("#pageList ul#page1")),$("#menu #main #elements").on("click","a:not(.btn)",function(){$("#menu #main a").removeClass("active"),$(this).addClass("active"),$("#menu #second ul li").hide(),$("#menu #second ul li."+$(this).attr("id")).show(),"all"==$(this).attr("id")&&$("#menu #second ul li").show(),$(".menu .second").css("display","block").stop().animate({width:secondMenuWidth},500)}),$("#menu").mouseleave(function(){$("#menu #main a").removeClass("active"),$(".menu .second").stop().animate({width:0},500,function(){$("#menu #second").hide()})}),$("#menu #main").on("click","a:not(.actionButtons)",function(e){e.preventDefault()}),$("#menu").mouseleave(function(){$("#menu #main a").removeClass("active"),$(".menu .second").stop().animate({width:0},500,function(){$("#menu #second").hide()})}),$("#hideSecond").on("click",function(){$(".menu .second").stop().animate({width:0},500,function(){$("#menu #second").hide()})}),$("input:radio[name=mode]").parent().addClass("disabled"),$("input:radio[name=mode]#modeBlock").radio("check");var e;$("input:radio[name=mode]").on("toggle",function(){closeStyleEditor(),$("#pageList ul .frameCover").each(function(){$(this).hide()}),$("#pageList ul li iframe").each(function(){for(var e in editableItems)$(this).contents().find(pageContainer+" "+e).unbind("hover").unbind("click")}),"content"==$(this).val()?$("#pageList ul li iframe").each(function(){for(i=0;i<editableContent.length;++i)$(this).contents().find(pageContainer+" "+editableContent[i]).unbind("click").unbind("hover"),$(this).contents().find(pageContainer+" "+editableContent[i]).hover(function(){$(this).css({outline:"3px dashed red",cursor:"pointer"})},function(){$(this).css({outline:"",cursor:""})}).click(function(t){e=$(this),t.preventDefault(),t.stopPropagation(),$("#editContentModal #contentToEdit").val($(this).html()),$("#editContentModal").modal("show"),"SMALL"==this.tagName||"A"==this.tagName||"LI"==this.tagName||"SPAN"==this.tagName||"B"==this.tagName||"I"==this.tagName||"TT"==this.tagName||"CODE"==this.tageName||"EM"==this.tagName||"STRONG"==this.tagName||"SUB"==this.tagName||"BUTTON"==this.tagName||"LABEL"==this.tagName||"P"==this.tagName||"H1"==this.tagName||"H2"==this.tagName||"H2"==this.tagName||"H3"==this.tagName||"H4"==this.tagName||"H5"==this.tagName||"H6"==this.tagName?$("#editContentModal #contentToEdit").redactor({buttons:["html","bold","italic","deleted"],focus:!0,plugins:["bufferbuttons"],buttonSource:!0,paragraphize:!1,linebreaks:!0}):"DIV"==this.tagName&&$(this).hasClass("tableWrapper")?$("#editContentModal #contentToEdit").redactor({buttons:["html","formatting","bold","italic","deleted","table","image","link","alignment"],focus:!0,plugins:["table","bufferbuttons"],buttonSource:!0,
paragraphize:!1,linebreaks:!1}):$("#editContentModal #contentToEdit").redactor({buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","file","link","alignment","horizontalrule"],focus:!0,buttonSource:!0,paragraphize:!1,linebreaks:!1})}).each(function(){$(this).attr("data-selector",i)})}):"block"==$(this).val()?($("#pageList ul .frameCover").each(function(){$(this).show()}),$("#pageList ul li iframe").each(function(){for(var e in editableItems)$(this).contents().find(pageContainer+" "+e).unbind("mouseenter mouseleave");this.contentDocument.designMode="off"})):"styling"==$(this).val()&&$("#pageList ul li iframe").each(function(){$(this).contents().find(pageContainer+" p").unbind("click").unbind("hover");for(var e in editableItems)$(this).contents().find(pageContainer+" "+e).hover(function(e){e.stopPropagation(),$(this).closest("body").width()!=$(this).width()?$(this).css({outline:"3px dashed red",cursor:"pointer"}):$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})},function(){$(this).css({outline:"",cursor:"","outline-offset":""})}).click(function(t){t.preventDefault(),t.stopPropagation(),styleClick(this,e)}).each(function(){$(this).attr("data-selector",e)})})}),$("button#updateContentInFrameSubmit").click(function(){e.html($("#editContentModal #contentToEdit").redactor("code.get")).css({outline:"",cursor:""}),sandboxID=hasSandbox(e),sandboxID&&(elementID=e.attr("id"),$("#"+sandboxID).contents().find("#"+elementID).html($("#editContentModal #contentToEdit").redactor("code.get"))),$("#editContentModal textarea").each(function(){$(this).redactor("core.destroy"),$(this).val("")}),$("#editContentModal").modal("hide"),$(this).closest("body").removeClass("modal-open").attr("style",""),heightAdjustment(e.get(0)),setPendingChanges(!0)}),$("#styleEditor > a.close").click(function(e){e.preventDefault(),closeStyleEditor()});var t;$("#pageList").on("click",".frameCover > .deleteBlock",function(){$("#deleteBlock").modal("show"),t=$(this).closest("li"),$("#deleteBlock").off("click","#deleteBlockConfirm").on("click","#deleteBlockConfirm",function(){var e=t.find("iframe").attr("data-sandbox");"undefined"!=typeof e&&e!==!1&&$("#sandboxes #"+e).remove(),$("#deleteBlock").modal("hide"),t.fadeOut(500,function(){$(this).remove(),pageEmpty(),allEmpty(),setPendingChanges(!0)})})}),$("#pageList").on("click",".frameCover > .resetBlock",function(){$("#resetBlock").modal("show"),frameToReset=$(this).closest("li").find("iframe"),$("#resetBlock").off("click","#resetBlockConfirm").on("click","#resetBlockConfirm",function(){$("#resetBlock").modal("hide"),frameToReset.get(0).contentWindow.location.reload();var e=frameToReset.attr("data-sandbox");"undefined"!=typeof e&&e!==!1&&document.getElementById(e).contentDocument.location.reload(!0)})});var n=new Array;$("#pageList").on("click",".frameCover > .htmlBlock",function(){$(this).closest(".li").find("iframe").hide(),$(this).closest("li").parent().sortable("disable"),theEditor=$('<div class="aceEditor"></div>'),theEditor.uniqueId(),$(this).closest("li").height()<300?($(this).closest("li").height(300),theEditor.height(300)):theEditor.height($(this).closest("li").height()),$(this).closest("li").append(theEditor),theId=theEditor.attr("id");var e=ace.edit(theId),t=$(this).closest("li").find("iframe").attr("data-sandbox");"undefined"!=typeof t&&t!==!1?(e.setValue($("#sandboxes #"+t).contents().find(pageContainer).html()),document.getElementById(t).contentDocument.location.reload(!0)):e.setValue($(this).closest("li").find("iframe").contents().find(pageContainer).html()),e.setTheme("ace/theme/twilight"),e.getSession().setMode("ace/mode/html"),cancelButton=$('<button type="button" class="btn btn-danger editCancelButton btn-wide"><span class="fui-cross"></span> Cancel</button>'),saveButton=$('<button type="button" class="btn btn-primary editSaveButton btn-wide"><span class="fui-check"></span> Save</button>'),buttonWrapper=$('<div class="editorButtons"></div>'),buttonWrapper.append(cancelButton),buttonWrapper.append(saveButton),$(this).closest("li").append(buttonWrapper),n[theId]=e}),$("#pageList").on("click","li .editorButtons .editCancelButton",function(){heightAdjustment($(this).closest("li").find("iframe").attr("id"),!0),$(this).closest("li").parent().sortable("enable"),$(this).parent().prev().remove(),$(this).closest("li").find(".zoomer-small iframe").fadeIn(500),$(this).parent().fadeOut(500,function(){$(this).remove()})}),$("#pageList").on("click","li .editorButtons .editSaveButton",function(){$(this).closest("li").parent().sortable("enable"),theId=$(this).closest(".editorButtons").prev().attr("id"),theContent=n[theId].getValue(),theiFrame=$(this).closest("li").find("iframe"),$(this).parent().prev().remove();var e=$(this).closest("li").find("iframe").attr("data-sandbox");if("undefined"!=typeof e&&e!==!1){if($("#sandboxes #"+e).contents().find(pageContainer).html(theContent),$(this).closest("li").find("iframe").show().contents().find(pageContainer).html(theContent),"undefined"!=typeof theiFrame.attr("data-loaderfunction")&&theiFrame.attr("data-loaderfunction")!==!1){var t="theiFrame[0].contentWindow."+theiFrame.attr("data-loaderfunction")+"()",i=new Function(t);i()}}else $(this).closest("li").find("iframe").show().contents().find(pageContainer).html(theContent);heightAdjustment($(this).closest("li").find("iframe").attr("id"),!0),$(this).parent().fadeOut(500,function(){$(this).remove()}),setPendingChanges(!0)}),$("#savePage").click(function(e){savePage(e)}),$("#previewModal").on("show.bs.modal",function(e){$("#previewModal > form #showPreview").show(""),$("#previewModal > form #previewCancel").text("Закрыть"),closeStyleEditor()}),$("#previewModal").on("shown.bs.modal",function(e){$('#previewModal form input[type="hidden"]').remove(),$("#pageList > ul:visible").each(function(){newDocMainParent=$("iframe#skeleton").contents().find(pageContainer),newDocMainParent.find("*").remove(),$(this).find("iframe").each(function(){var e=$(this).attr("data-sandbox");"undefined"!=typeof e&&e!==!1?theContents=$("#sandboxes #"+e).contents().find(pageContainer):theContents=$(this).contents().find(pageContainer),theContents.find(".frameCover").each(function(){$(this).remove()});for(var t in editableItems)theContents.find(t).each(function(){$(this).removeAttr("data-selector"),""==$(this).attr("style")&&$(this).removeAttr("style")});for(i=0;i<editableContent.length;++i)$(this).contents().find(editableContent[i]).each(function(){$(this).removeAttr("data-selector")});toAdd=theContents.html(),scripts=$(this).contents().find(pageContainer).find("script"),scripts.size()>0&&(theIframe=document.getElementById("skeleton"),scripts.each(function(){if(""!=$(this).text()){var e=theIframe.contentWindow.document.createElement("script");e.type="text/javascript",e.innerHTML=$(this).text(),theIframe.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(e)}else if(null!=$(this).attr("src")){var e=theIframe.contentWindow.document.createElement("script");e.type="text/javascript",e.src=$(this).attr("src"),theIframe.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(e)}})),newDocMainParent.append($(toAdd))}),newInput=$('<input type="hidden" name="page" value="">'),$("#previewModal form").prepend(newInput),newInput.val("<html>"+$("iframe#skeleton").contents().find("html").html()+"</html>")})}),$("#previewModal > form").submit(function(){$("#previewModal > form #showPreview").hide(""),$("#previewModal > form #previewCancel").text("Закрыть")}),$("#xsDgnInput").on("change",function(){var e=this.value.match(/\.(.+)$/)[1];if($.inArray(e,["xs"])==-1){var t="Please upload save Project file!";$("#xsErrorModal .modal-body").html(t),$("#xsErrorModal").modal("show")}else $("#xsclearCanvas").modal("show"),$("#xsImpModal").modal("hide")}),$("#xsclearCanvasImport").on("click",function(){$("#xsImportForm").submit()}),$("#exportModal").on("show.bs.modal",function(e){$("#exportModal > form #exportSubmit").show(""),$("#exportModal > form #exportCancel").text("Отменить и закрыть"),closeStyleEditor()}),$("#exportModal").on("shown.bs.modal",function(e){$('#exportModal form input[type="hidden"]').remove(),$("#pageList > ul").each(function(){newDocMainParent=$("iframe#skeleton").contents().find(pageContainer),newDocMainParent.find("*").remove(),$(this).find("iframe").each(function(){var e=$(this).attr("data-sandbox");"undefined"!=typeof e&&e!==!1?theContents=$("#sandboxes #"+e).contents().find(pageContainer):theContents=$(this).contents().find(pageContainer),theContents.find(".frameCover").each(function(){$(this).remove()});for(var t in editableItems)theContents.find(t).each(function(){$(this).removeAttr("data-selector"),""==$(this).attr("style")&&$(this).removeAttr("style")});for(i=0;i<editableContent.length;++i)$(this).contents().find(editableContent[i]).each(function(){$(this).removeAttr("data-selector")});toAdd=theContents.html(),scripts=$(this).contents().find(pageContainer).find("script"),scripts.size()>0&&(theIframe=document.getElementById("skeleton"),scripts.each(function(){if(""!=$(this).text()){var e=theIframe.contentWindow.document.createElement("script");e.type="text/javascript",e.innerHTML=$(this).text(),theIframe.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(e)}else if(null!=$(this).attr("src")){var e=theIframe.contentWindow.document.createElement("script");e.type="text/javascript",e.src=$(this).attr("src"),theIframe.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(e)}})),newDocMainParent.append($(toAdd))}),newInput=$('<input type="hidden" name="pages['+$("#pages li:eq("+($(this).index()+1)+") a:first").text()+']" value="">'),$("#exportModal form").prepend(newInput),newInput.val("<html>"+$("iframe#skeleton").contents().find("html").html()+"</html>")})}),$("#exportModal > form").submit(function(){$("#exportModal > form #exportSubmit").hide(""),$("#exportModal > form #exportCancel").text("Закрыть")}),$("#clearScreen").click(function(){$("#deleteAll").modal("show"),$("#deleteAll").on("click","#deleteAllConfirm",function(){$("#deleteAll").modal("hide"),$("#pageList ul:visible li").fadeOut(500,function(){$(this).remove(),pageEmpty(),allEmpty()}),$("#sandboxes iframe").each(function(){$(this).remove()})}),setPendingChanges(!0)}),$("#pages").on("blur","li > input",function(){0==$(this).parent().find("a.plink").size()&&(theLink=$('<a href="#'+$(this).val()+'" class="plink">'+$(this).val()+"</a>"),$(this).hide(),$(this).closest("li").prepend(theLink),$(this).closest("li").removeClass("edit"),$("#internalLinksDropdown option:eq("+$(this).parent().index()+")").text($(this).val()).attr("value",$(this).val()+".html"),$("select#internalLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"}),$(this).remove())}),$("#addPage").click(function(e){e.preventDefault(),$("#pages li.active").each(function(){$(this).find("input").size()>0&&(theLink=$('<a href="#">'+$(this).find("input").val()+"</a>"),$(this).find("input").remove(),$(this).prepend(theLink))}),$("#pages li").removeClass("active"),newPageLI=$("#newPageLI").clone(),newPageLI.css("display","block"),newPageLI.find("input").val("page"+$("#pages li").size()),newPageLI.attr("id",""),$("ul#pages").append(newPageLI),theInput=newPageLI.find("input"),theInput.focus();var t=theInput.val();theInput.val(""),theInput.val(t),theInput.keyup(function(){$("#pageTitle span span").text($(this).val())}),newPageLI.addClass("active").addClass("edit"),newPageList=$("<ul></ul>"),newPageList.css("display","block"),newPageList.attr("id","page"+($("#pages li").size()-1)),$("#pageList > ul").hide(),$("#pageList").append(newPageList),makeSortable(newPageList),makeDraggable("#page"+($("#pages li").size()-1)),$("#pageTitle span span").text("page"+($("#pages li").size()-1)),$("#frameWrapper").addClass("empty"),$("#start").fadeIn(),newItem=$('<option value="page'+($("#pages li").size()-1)+'.html">page'+($("#pages li").size()-1)+"</option>"),$("#internalLinksDropdown").append(newItem),$("select#internalLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"}),setPendingChanges(!0)}),$("#pages").on("click","li:not(.active)",function(){$("#pageList > ul").hide(),$("#pageList > ul:eq("+($(this).index()-1)+")").show(),pageEmpty(),makeDraggable("#page"+$(this).index()),$("#pages li").removeClass("active").removeClass("edit"),$(this).addClass("active"),$("#pageTitle span span").text($(this).find("a").text())}),$("#pages").on("click","li.active .fileSave",function(){theLI=$(this).closest("li"),theLI.find("input").size()>0&&(theLink=$('<a href="#'+theLI.find("input").val()+'">'+theLI.find("input").val()+"</a>"),theLI.find("input").remove(),theLI.prepend(theLink)),$("#pages li").removeClass("edit")}),$("#pages").on("click","li.active .fileEdit",function(){theLI=$(this).closest("li"),newInput=$('<input type="text" value="'+theLI.find("a:first").text()+'" name="page">'),theLI.find("a:first").remove(),theLI.prepend(newInput),newInput.focus();var e=newInput.val();newInput.val(""),newInput.val(e),newInput.keyup(function(){$("#pageTitle span span").text($(this).val())}),theLI.addClass("edit"),setPendingChanges(!0)});var a;$("#pages").on("click","li.active .fileDel",function(){a=$(this).parent().parent().index(),$("#deletePage").modal("show"),$("#deletePageCancel").click(function(){$("#deletePage").modal("hide")}),$("#deletePage").off("click").on("click","#deletePageConfirm",function(e){$("#deletePage").modal("hide"),$("#pages li:eq("+a+")").remove(),$("#pageList ul:visible").remove(),$("select#internalLinksDropdown option:eq("+a+")").remove(),$(".link_Tab .dropdown-menu li:eq("+a+")").remove(),$("#pages li:eq(1)").addClass("active"),$("#pageList ul:first").show(),$("#pageTitle span span").text($("#pages li:eq(1)").find("a:first").text()),makeDraggable("#page1"),pageEmpty(),allEmpty(),savePage(e),setPendingChanges(!0)})}),$("#editContentModal").on("hidden.bs.modal",function(e){$("#editContentModal #contentToEdit").redactor("core.destroy")})});