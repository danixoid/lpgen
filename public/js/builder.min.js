var pageContainer="#page";var enablePreview=true;var editableItems=new Array();editableItems[".frameCover"]=[];editableItems["nav#main-navbar"]=["background-color","box-shadow"];editableItems["nav a"]=["font-weight","font-size","text-transform"];editableItems["nav a.btn-nav"]=["font-weight","font-size","background-color"];editableItems[".nav-callus"]=["color","font-weight","font-size","text-transform"];editableItems["a.edit"]=["color","font-weight","font-size","text-transform"];editableItems[".text-edit"]=["color","font-weight","font-size","text-transform","background-color"];editableItems.img=["border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius","border-color","border-style","border-width"];editableItems[".bg-img"]=["background-color"];editableItems.h1=["color","font-size","background-color","font-family","font-weight"];editableItems.h2=["color","font-size","background-color","font-family","font-weight"];editableItems.h3=["color","font-size","background-color","font-family","font-weight"];editableItems.h4=["color","font-size","background-color","font-family","font-weight"];editableItems.h5=["color","font-size","background-color","font-family","font-weight"];editableItems.h6=["color","font-size","background-color","font-family","font-weight"];editableItems.p=["color","font-size","background-color","font-family","font-weight"];editableItems["a.btn, button.btn, .btn"]=["border-radius","font-size","background-color","box-shadow","border-color","border-style","border-width"];editableItems[".bg-edit"]=["background-color"];editableItems[".block-edit"]=["background-image"];editableItems["i, span.fa"]=["color","font-size"];var editableItemOptions=new Array();editableItemOptions["nav a : font-weight"]=["700","300","400","900"];editableItemOptions["nav a.btn-nav : font-weight"]=["700","300","400","900"];editableItemOptions["img : border-style"]=["none","dotted","dashed","solid"];editableItemOptions["img : border-width"]=["1px","2px","3px","4px"];editableItemOptions["h1 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h2 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h3 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h4 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h5 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h6 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["p : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];var editableContent=[".editContent",".navbar a","a.edit","h1:not(.no-edit)","h2:not(.no-edit)","h3:not(.no-edit)","h4:not(.no-edit)","h5:not(.no-edit)","h6:not(.no-edit)","p:not(.no-edit)",".nav-callus",".text-edit",".btn:not(.no-edit)",".footer a:not(.fa)",".tableWrapper"];$(function(){$(".nav-tabs a").on("click",function(a){a.preventDefault();$(this).tab("show")})});var mainMenuWidth=230;var secondMenuWidth=300;$(window).load(function(){$("#loader").fadeOut(function(){$("#menu").animate({left:"-190px"},1000)});if(enablePreview==true){$("#preview").show()}loadPagesByDomain($("#selectDomain").val());$("#selectDomain").on("change",function(a){loadPagesByDomain($("#selectDomain").val())});$("#auth").submit(function(b){var a=$(this);b.preventDefault();$.get("/_token",function(d){$.ajaxSetup({headers:{"X-CSRF-TOKEN":d._token}});$.ajax({url:a.attr("action"),data:a.serialize(),dataType:"json",type:"POST"}).done(function(e){$("#auth .modal").modal("hide");savePage(b)}).error(function(e){var f="";console.log(e.responseText);$.each(JSON.parse(e.responseText),function(g,h){f+=h+"\n"});alert(f)})})})});function loadPagesByDomain(a){var e=$("#getBlocksForm");var b=e.attr("action");var d=e.attr("method");$("#domainHidden").val(a);$.ajax({url:b+"?domain_id="+a,cache:false,contentType:false,processData:false,dataType:"json",type:d}).done(function(g){$("#pageList ul#page1").empty();$("#pageList ul.generate-ul").remove();$("ul#pages li.generate-li").remove();var h=[];for(x=0;x<g.length;x++){var j=x+1;if($("ul#page"+j).size()==0){newUL=$('<ul id="page'+j+'" class="generate-ul"></ul>');$("#pageList").append(newUL);makeSortable(newUL);newItem=$('<option value="/'+g[x].name+'">'+g[x].name+"</option>");$("#internalLinksDropdown").append(newItem)}for(var k=0;k<g[x].l_blocks.length;k++){$("#start").hide();if(g[x].l_blocks[k]!=null){toInsert=$("<li>"+g[x].l_blocks[k].frame+"</li>");toInsert.find("iframe").attr("id","ui-id-"+x+k);toInsert.find(".frameCover").show();var f=toInsert.find("iframe").attr("data-sandbox");if(typeof f!==typeof undefined&&f!==false){theiFrame=toInsert.find("iframe");theID=theiFrame.attr("data-sandbox");sandboxedFrame=$('<iframe src="'+theiFrame.attr("src")+'" id="'+theID+'" sandbox="allow-same-origin"></iframe>');$("#sandboxes").append(sandboxedFrame)}h[toInsert.find("iframe").attr("id")]=g[x].l_blocks[k].element;toInsert.find("iframe").load(function(){$(this).contents().find(pageContainer).html(h[$(this).attr("id")]);var l=$(this).attr("data-sandbox");if(typeof l!==typeof undefined&&l!==false){$("iframe#"+$(this).attr("data-sandbox")).contents().find(pageContainer).html(h[$(this).attr("id")]);theLoaderFunction=$(this).data("data-loaderfunction");theiFrame=$(this);var m="theiFrame[0].contentWindow."+theiFrame.attr("data-loaderfunction")+"()";var n=new Function(m);n()}});$("ul#page"+j).append(toInsert)}}if(j>1&&typeof g[x].name!="undefined"){newLI=$('<li class="generate-li"><a class="plink" href="#page'+j+'">'+g[x].name+'</a><span class="pageButtons"><a class="fileEdit" href=""><span class="fui-new"></span></a><a class="fileDel" href=""><span class="fui-cross"></span></a><a href="#" class="btn btn-xs btn-primary btn-embossed fileSave"><span class="fui-check"></span></a></span></li>');$("ul#pages").append(newLI)}}allEmpty()})}var hexDigits=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");function rgb2hex(a){a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return"#"+hex(a[1])+hex(a[2])+hex(a[3])}function hex(a){return isNaN(a)?"00":hexDigits[(a-a%16)/16]+hexDigits[a%16]}function getRandomArbitrary(b,a){return Math.floor(Math.random()*(a-b)+b)}var pendingChanges=false;function setPendingChanges(a){if(a==true){$(window).bind("beforeunload",function(){return">>>>>Before You Go<<<<<<<< \n Your custom message go here"});$("#savePage .bLabel").text("Сохранить изменения (!)");pendingChanges=true}else{$(window).unbind("beforeunload");$("#savePage .bLabel").text("Сохранено");pendingChanges=false}}function pageEmpty(){if($("#pageList ul:visible > li").size()==0){$("#start").show();$("#frameWrapper").addClass("empty")}else{$("#start").hide();$("#frameWrapper").removeClass("empty")}}function allEmpty(){var a=false;if($("#pageList li").size()==0){a=true}else{a=false}if(a){$("a.actionButtons").each(function(){$(this).addClass("disabled")});$("header .modes input").each(function(){$(this).prop("disabled",true).parent().addClass("disabled")})}else{$("header .modes input").each(function(){$(this).prop("disabled",false).parent().removeClass("disabled")});$("a.actionButtons").each(function(){$(this).removeClass("disabled")})}}function makeDraggable(a){$("#second #elements li").each(function(){$(this).draggable({helper:function(){return $('<div style="height: 100px; width: 300px; background: #F9FAFA; box-shadow: 5px 5px 1px rgba(0,0,0,0.1); text-align: center; line-height: 100px; font-size: 28px; color: #16A085"><span class="fui-list"></span></div>')},revert:"invalid",appendTo:"body",connectToSortable:a,stop:function(){pageEmpty();allEmpty()},start:function(){$("input:radio[name=mode]").parent().addClass("disabled");$("input:radio[name=mode]#modeBlock").radio("check");$("#pageList ul .zoomer-wrapper .zoomer-cover").each(function(){$(this).show()});$("#pageList ul li iframe").each(function(){this.contentDocument.designMode="off"})}})});$("#elements li a").each(function(){$(this).unbind("click").bind("click",function(b){b.preventDefault()})})}var frameContents="";function makeSortable(a){a.sortable({revert:true,placeholder:"drop-hover",handle:".frameCover",beforeStop:function(e,f){if(f.item.find(".frameCover").size()==0){if(f.item.find("iframe").size()>0){var d=f.item.height();if(d<50){d=100}var b=f.item.find("iframe").attr("data-sandbox");if(typeof b!==typeof undefined&&b!==false){theID=getRandomArbitrary(10000,1000000000);sandboxedFrame=$('<iframe src="'+f.item.find("iframe").attr("src")+'" id="'+theID+'" sandbox="allow-same-origin"></iframe>');$("#sandboxes").append(sandboxedFrame);if(typeof f.item.find("iframe").attr("data-loaderfunction")!==typeof undefined&&f.item.find("iframe").attr("data-loaderfunction")!==false){loaderFunction_='data-loaderfunction="'+f.item.find("iframe").attr("data-loaderfunction")+'"'}f.item.html('<iframe src="'+f.item.find("iframe").attr("src")+'" scrolling="no" frameborder="0" data-sandbox="'+theID+'" '+loaderFunction_+"><iframe>")}else{f.item.html('<iframe src="'+f.item.find("iframe").attr("src")+'" scrolling="no" frameborder="0"><iframe>')}f.item.find("iframe").uniqueId();f.item.find("iframe").height(d+"px")}else{var d=f.item.find("img").attr("data-height");if(d<50){d=100}var b=f.item.find("img").attr("data-sandbox");if(typeof b!==typeof undefined&&b!==false){theID=getRandomArbitrary(10000,1000000000);sandboxedFrame=$('<iframe src="'+f.item.find("img").attr("data-srcc")+'" id="'+theID+'" sandbox="allow-same-origin"></iframe>');$("#sandboxes").append(sandboxedFrame);if(typeof f.item.find("img").attr("data-loaderfunction")!==typeof undefined&&f.item.find("img").attr("data-loaderfunction")!==false){loaderFunction_='data-loaderfunction="'+f.item.find("img").attr("data-loaderfunction")+'"'}f.item.html('<iframe src="'+f.item.find("img").attr("data-srcc")+'" scrolling="no" frameborder="0" data-sandbox="'+theID+'" '+loaderFunction_+"><iframe>")}else{f.item.html('<iframe src="'+f.item.find("img").attr("data-srcc")+'" scrolling="no" frameborder="0"><iframe>')}f.item.find("iframe").uniqueId();f.item.find("iframe").height(d+"px");f.item.find("iframe").css("background","#ffffff url(images/loading.gif) 50% 50% no-repeat");f.item.find("iframe").load(function(){heightAdjustment(f.item.find("iframe").attr("id"),true)})}delButton=$('<button type="button" class="btn btn-danger deleteBlock"><span class="fui-trash"></span> Удалить</button>');resetButton=$('<button type="button" class="btn btn-warning resetBlock"><i class="fa fa-refresh"></i> Сброс</button>');htmlButton=$('<button type="button" class="btn btn-inverse htmlBlock"><i class="fa fa-code"></i> Код</button>');frameCover=$('<div class="frameCover"></div>');frameCover.append(delButton);frameCover.append(resetButton);frameCover.append(htmlButton);f.item.append(frameCover)}else{f.item.find("iframe").load(function(){$(this).contents().find(pageContainer).html(frameContents)})}setPendingChanges(true)},stop:function(){$("#pageList ul:visible li").each(function(){$(this).find(".zoomer-cover > a").remove()})},start:function(b,d){if(d.item.find(".frameCover").size()!=0){frameContents=d.item.find("iframe").contents().find(pageContainer).html()}},over:function(){$("#start").hide()}})}function buildeStyleElements(a,b){for(x=0;x<editableItems[b].length;x++){newStyleEl=$("#styleElTemplate").clone();newStyleEl.attr("id","");newStyleEl.find(".control-label").text(editableItems[b][x]+":");if(b+" : "+editableItems[b][x] in editableItemOptions){newStyleEl.find("input").remove();newDropDown=$("<select></select>");newDropDown.attr("name",editableItems[b][x]);for(z=0;z<editableItemOptions[b+" : "+editableItems[b][x]].length;z++){newOption=$('<option value="'+editableItemOptions[b+" : "+editableItems[b][x]][z]+'">'+editableItemOptions[b+" : "+editableItems[b][x]][z]+"</option>");if(editableItemOptions[b+" : "+editableItems[b][x]][z]==$(a).css(editableItems[b][x])){newOption.attr("selected","true")}newDropDown.append(newOption)}newStyleEl.append(newDropDown);newDropDown.selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"})}else{newStyleEl.find("input").val($(a).css(editableItems[b][x])).attr("name",editableItems[b][x]);if(editableItems[b][x].indexOf("color")>-1){if($(a).css(editableItems[b][x])!="transparent"&&$(a).css(editableItems[b][x])!="none"&&$(a).css(editableItems[b][x])!=""){newStyleEl.val($(a).css(editableItems[b][x]))}newStyleEl.find("input").spectrum({preferredFormat:"hex",showPalette:true,allowEmpty:true,showInput:true,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]]})}}newStyleEl.css("display","block");$("#styleElements").append(newStyleEl);$("#styleEditor form#stylingForm").height("auto")}}function getParentFrameID(a){theID="";$("#pageList li:visible iframe").each(function(){theBody=$(this).contents().find("body");if($.contains(document.getElementById($(this).attr("id")).contentWindow.document,a)){theID=$(this).attr("id")}});if(theID!=""){return theID}}function heightAdjustment(b,a){a=typeof a!=="undefined"?a:false;if(a==false){$("#pageList li:visible iframe").each(function(){theBody=$(this).contents().find("body");if($.contains(document.getElementById($(this).attr("id")).contentWindow.document,b)){frameID=$(this).attr("id")}});theFrame=document.getElementById(frameID)}else{theFrame=document.getElementById(b)}realHeight=theFrame.contentWindow.document.body.offsetHeight;$(theFrame).height(realHeight+"px");$(theFrame).parent().height((realHeight)+"px");$(theFrame).next().height((realHeight)+"px")}function hasSandbox(b){var a=$("#"+getParentFrameID(b.get(0))).attr("data-sandbox");if(typeof a!==typeof undefined&&a!==false){return a}else{return false}}var _oldIcon=new Array();function styleClick(f){var g=$(f).attr("data-selector");$("#editingElement").text(g);$("#detailTabs a:first").click();$("a#link_Link").parent().hide();$("a#img_Link").parent().hide();$("a#icon_Link").parent().hide();$("a#video_Link").parent().hide();if($(f).prop("tagName")=="A"||$(f).parent().prop("tagName")=="A"){$("a#link_Link").parent().show();if($(f).prop("tagName")=="A"){theHref=$(f).attr("href")}else{if($(f).parent().prop("tagName")=="A"){theHref=$(f).parent().attr("href")}}zIndex=0;pageLink=false;$("select#internalLinksDropdown").prop("selectedIndex",0);$("select#internalLinksDropdown option").each(function(){if($(this).attr("value")==theHref){$(this).attr("selected",true);zIndex=$(this).index();pageLink=true}});$(".link_Tab .btn-group.select .dropdown-menu li").removeClass("selected");$(".link_Tab .btn-group.select .dropdown-menu li:eq("+zIndex+")").addClass("selected");$(".link_Tab .btn-group.select:eq(0) .filter-option").text($("select#internalLinksDropdown option:selected").text());$(".link_Tab .btn-group.select:eq(1) .filter-option").text($("select#pageLinksDropdown option:selected").text());if(pageLink==true){$("input#internalLinksCustom").val("")}else{if($(f).prop("tagName")=="A"){if($(f).attr("href")[0]!="#"){$("input#internalLinksCustom").val($(f).attr("href"))}else{$("input#internalLinksCustom").val("")}}else{if($(f).parent().prop("tagName")=="A"){if($(f).parent().attr("href")[0]!="#"){$("input#internalLinksCustom").val($(f).parent().attr("href"))}else{$("input#internalLinksCustom").val("")}}}}$("select#pageLinksDropdown option:not(:first)").remove();$("#pageList ul:visible iframe").each(function(){if($(this).contents().find(pageContainer+" > *:first").attr("id")!=undefined){if($(f).attr("href")=="#"+$(this).contents().find(pageContainer+" > *:first").attr("id")){newOption="<option selected value=#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+">#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+"</option>"}else{newOption="<option value=#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+">#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+"</option>"}$("select#pageLinksDropdown").append(newOption)}})}if($(f).attr("data-type")=="video"){$("a#video_Link").parent().show();$("a#video_Link").click();if($(f).prev().attr("src").indexOf("vimeo.com")>-1){d=$(f).prev().attr("src").match(/player\.vimeo\.com\/video\/([0-9]*)/);$("#video_Tab input#vimeoID").val(d[d.length-1]);$("#video_Tab input#youtubeID").val("")}else{var e=/.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/;var d=$(f).prev().attr("src").match(e);$("#video_Tab input#youtubeID").val(d[1]);$("#video_Tab input#vimeoID").val("")}}if($(f).prop("tagName")=="IMG"){$("a#img_Link").parent().show();$(".imageFileTab").find("a.fileinput-exists").click();var h=$(f).attr("src");var a=$('<img src="'+h+'" />');$(".imageFileTab").find(".fileinput-preview").append(a);$(".imageFileTab").find("input#imageURL").val($(f).attr("src"))}if($(f).hasClass("bg-img")){$(".imageFileTab").find("a.fileinput-exists").click();var h=$(f).css("background-image").match(/https?:\/\/[^\"]+/gi)[0];var a=$('<img src="'+h+'"/>');$("a#img_Link").parent().show();$(".imageFileTab").find("input#imageURL").val(h);$(".imageFileTab").find(".fileinput-preview ").append(a)}if($(f).hasClass("fa")){$("a#icon_Link").parent().show();var b=$.grep(f.className.split(" "),function(j,k){return j.indexOf("fa-")===0}).join();$("select#icons option").each(function(){if($(this).val()==b){$(this).attr("selected",true);$("#icons").trigger("chosen:updated")}})}$("#pageList ul:visible li iframe").each(function(){for(var j in editableItems){$(this).contents().find(pageContainer+" "+j).css({outline:"none",cursor:"default"});$(this).contents().find(pageContainer+" "+j).hover(function(k){k.stopPropagation();if($(this).closest("body").width()!=$(this).width()){$(this).css({outline:"3px dashed red",cursor:"pointer"})}else{$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}},function(){if($(this).closest("body").width()!=($(this).width()+6)){$(this).css({outline:"",cursor:""})}else{$(this).css({border:"",cursor:"","outline-offset":""})}})}});$(f).unbind("mouseenter mouseleave");if($(f).closest("body").width()!=$(f).width()){$(f).css({outline:"3px dashed red",cursor:"pointer"})}else{$(f).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}$("#styleElements > *:not(#styleElTemplate)").each(function(){$(this).remove()});buildeStyleElements(f,g);if($("#styleEditor").css("left")=="-300px"){$("#styleEditor").animate({left:"0px"},250)}$("button#saveStyling").unbind("click").bind("click",function(){$("#styleEditor #tab1 .form-group:not(#styleElTemplate) input, #styleEditor #tab1 .form-group:not(#styleElTemplate) select").each(function(){$(f).css($(this).attr("name"),$(this).val());sandboxID=hasSandbox($(f));if(sandboxID){elementID=$(f).attr("id");$("#"+sandboxID).contents().find("#"+elementID).css($(this).attr("name"),$(this).val())}});if($(f).prop("tagName")=="A"){if($("select#internalLinksDropdown").val()!="#"){$(f).attr("href",$("select#internalLinksDropdown").val())}else{if($("select#pageLinksDropdown").val()!="#"){$(f).attr("href",$("select#pageLinksDropdown").val())}else{if($("input#internalLinksCustom").val()!=""){$(f).attr("href",$("input#internalLinksCustom").val())}}}sandboxID=hasSandbox($(f));if(sandboxID){elementID=$(f).attr("id");if($("select#internalLinksDropdown").val()!="#"){$("#"+sandboxID).contents().find("#"+elementID).attr("href",$("select#internalLinksDropdown").val())}else{if($("select#pageLinksDropdown").val()!="#"){$("#"+sandboxID).contents().find("#"+elementID).attr("href",$("select#pageLinksDropdown").val())}else{if($("input#internalLinksCustom").val()!=""){$("#"+sandboxID).contents().find("#"+elementID).attr("href",$("input#internalLinksCustom").val())}}}}}if($(f).parent().prop("tagName")=="A"){if($("select#internalLinksDropdown").val()!="#"){$(f).parent().attr("href",$("select#internalLinksDropdown").val())}else{if($("select#pageLinksDropdown").val()!="#"){$(f).parent().attr("href",$("select#pageLinksDropdown").val())}else{if($("input#internalLinksCustom").val()!=""){$(f).parent().attr("href",$("input#internalLinksCustom").val())}}}sandboxID=hasSandbox($(f));if(sandboxID){elementID=$(f).attr("id");if($("select#internalLinksDropdown").val()!="#"){$("#"+sandboxID).contents().find("#"+elementID).parent().attr("href",$("select#internalLinksDropdown").val())}else{if($("select#pageLinksDropdown").val()!="#"){$("#"+sandboxID).contents().find("#"+elementID).parent().attr("href",$("select#pageLinksDropdown").val())}else{if($("input#internalLinksCustom").val()!=""){$("#"+sandboxID).contents().find("#"+elementID).parent().attr("href",$("input#internalLinksCustom").val())}}}}}if($("a#img_Link").css("display")=="block"&&$("input#imageFileField").val()!=""){var m=$("form#imageUploadForm");var j=false;if(window.FormData){j=new FormData(m[0])}var k=m.attr("action");$.ajax({url:k,data:j?j:m.serialize(),cache:false,contentType:false,processData:false,dataType:"json",type:"POST"}).done(function(o,n){if(n==401){$("#auth.modal").modal("show")}else{if(o.code==1){$("input#imageURL").val(o.response);if($(f).hasClass("bg-img")){var p="url('"+o.response+"')";$(f).css("background-image",p);$(f).css("-webkit-background-size","cover");$(f).css("-moz-background-size","cover");$(f).css("background-size","cover");$(f).css("background-repeat","no-repeat");$(f).css("background-position","center center");$(f).css("background-attachment","scroll")}else{$(f).attr("src",o.response)}$(".imageFileTab").find("a.fileinput-exists").click();sandboxID=hasSandbox($(f));if(sandboxID){elementID=$(f).attr("id");$("#"+sandboxID).contents().find("#"+elementID).attr("src",o.response)}}else{if(o.code==0){alert("Something went wrong: "+o.response)}}}})}else{if($("a#img_Link").css("display")=="block"){if($("input#imageURL").val()!=""&&$("input#imageURL").val()!=$(f).attr("src")){$(f).attr("src",$("input#imageURL").val());sandboxID=hasSandbox($(f));if(sandboxID){elementID=$(f).attr("id");$("#"+sandboxID).contents().find("#"+elementID).attr("src",$("input#imageURL").val())}}}}if($(f).hasClass("fa")){var l=$.grep(f.className.split(" "),function(n,o){return n.indexOf("fa-")===0}).join();if(l!=$("select#icons").val()){$(f).uniqueId();_oldIcon[$(f).attr("id")]=l}$(f).removeClass(l).addClass($("select#icons").val());sandboxID=hasSandbox($(f));if(sandboxID){elementID=$(f).attr("id");$("#"+sandboxID).contents().find("#"+elementID).removeClass(l).addClass($("select#icons").val())}}if($(f).attr("data-type")=="video"){if($("input#youtubeID").val()!=""){$(f).prev().attr("src","//www.youtube.com/embed/"+$("#video_Tab input#youtubeID").val())}else{if($("input#vimeoID").val()!=""){$(f).prev().attr("src","//player.vimeo.com/video/"+$("#video_Tab input#vimeoID").val()+"?title=0&amp;byline=0&amp;portrait=0")}}sandboxID=hasSandbox($(f));if(sandboxID){elementID=$(f).attr("id");if($("input#youtubeID").val()!=""){$("#"+sandboxID).contents().find("#"+elementID).prev().attr("src","//www.youtube.com/embed/"+$("#video_Tab input#youtubeID").val())}else{if($("input#vimeoID").val()!=""){$("#"+sandboxID).contents().find("#"+elementID).prev().attr("src","//player.vimeo.com/video/"+$("#video_Tab input#vimeoID").val()+"?title=0&amp;byline=0&amp;portrait=0")}}}}$("#detailsAppliedMessage").fadeIn(600,function(){setTimeout(function(){$("#detailsAppliedMessage").fadeOut(1000)},3000)});heightAdjustment(f);setPendingChanges(true)});$("button#removeElementButton").unbind("click").bind("click",function(){if($(f).prop("tagName")=="A"){if($(f).parent().prop("tagName")=="LI"){toDel=$(f).parent()}else{toDel=$(f)}}else{if($(f).prop("tagName")=="IMG"){if($(f).parent().prop("tagName")=="A"){toDel=$(f).parent()}else{toDel=$(f)}}else{toDel=$(f)}}$("#styleEditor").on("click","button#removeElementButton",function(){$("#deleteElement").modal("show");$("#deleteElement button#deleteElementConfirm").unbind("click").bind("click",function(){toDel.fadeOut(500,function(){randomEl=$(this).closest("body").find("*:first");toDel.remove();heightAdjustment(randomEl[0])});$("#deleteElement").modal("hide");closeStyleEditor()})})});$("button#cloneElementButton").unbind("click").bind("click",function(){if($(f).parent().hasClass("propClone")){theClone=$(f).parent().clone();theClone.find($(f).prop("tagName")).attr("style","");theOne=theClone.find($(f).prop("tagName"));cloned=$(f).parent();cloneParent=$(f).parent().parent()}else{theClone=$(f).clone();theClone.attr("style","");theOne=theClone;cloned=$(f);cloneParent=$(f).parent()}cloned.after(theClone);for(var j in editableItems){$(f).closest("body").find(pageContainer+" "+j).each(function(){if($(this)[0]===$(theOne)[0]){theOne.hover(function(){if($(this).closest("body").width()!=$(this).width()){$(this).css({outline:"3px dashed red",cursor:"pointer"})}else{$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}},function(){if($(this).closest("body").width()!=($(this).width()+6)){$(this).css({outline:"",cursor:""})}else{$(this).css({outline:"",cursor:"","outline-offset":""})}}).click(function(k){k.preventDefault();k.stopPropagation();styleClick(this,j)}).each(function(){$(this).attr("data-selector",j)})}})}heightAdjustment(f)});$("button#resetStyleButton").unbind("click").bind("click",function(){if($(f).closest("body").width()!=$(f).width()){$(f).attr("style","").css({outline:"3px dashed red",cursor:"pointer"})}else{$(f).attr("style","").css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}$("#styleEditor form#stylingForm").height($("#styleEditor form#stylingForm").height()+"px");$("#styleEditor form#stylingForm .form-group:not(#styleElTemplate)").fadeOut(500,function(){$(this).remove()});if(_oldIcon[$(f).attr("id")]!=null){var j=$.grep(f.className.split(" "),function(k,l){return k.indexOf("fa-")===0}).join();$(f).removeClass(j).addClass(_oldIcon[$(f).attr("id")]);$("select#icons option").each(function(){if($(this).val()==_oldIcon[$(f).attr("id")]){$(this).attr("selected",true);$("#icons").trigger("chosen:updated")}})}setTimeout(function(){buildeStyleElements(f,g)},550)})}function closeStyleEditor(){if($("#styleEditor").css("left")=="0px"){$("#styleEditor").animate({left:"-300px"},250);$("#pageList ul li iframe").each(function(){for(var a in editableItems){$(this).contents().find(pageContainer+" "+a).unbind("mouseenter mouseleave click").css({outline:"",cursor:""})}if($("input:radio[name=mode]:checked").val()=="styling"){$("#pageList ul li iframe").each(function(){for(var b in editableItems){$(this).contents().find(pageContainer+" "+b).hover(function(d){d.stopPropagation();if($(this).closest("body").width()!=$(this).width()){$(this).css({outline:"3px dashed red",cursor:"pointer"})}else{$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}},function(){if($(this).closest("body").width()!=($(this).width()+6)){$(this).css({outline:"",cursor:""})}else{$(this).css({outline:"",cursor:"","outline-offset":""})}}).click(function(d){d.preventDefault();d.stopPropagation();styleClick(this,b)})}})}})}}$(function(){$("input#youtubeID").focus(function(){$("input#vimeoID").val("")});$("input#vimeoID").focus(function(){$("input#youtubeID").val("")});$("select#icons").chosen({search_contains:true});if(window.location.protocol=="file:"){_mode="local"}else{_mode="server"}if(!window.FormData){$("form#imageUploadForm").hide();$(".imageFileTab .or").hide()}$("select#internalLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"});$("select#internalLinksDropdown").change(function(){$("select#pageLinksDropdown option").attr("selected",false);$(".link_Tab .btn-group.select:eq(1) .dropdown-menu li").removeClass("selected");$(".link_Tab .btn-group.select:eq(1) > button .filter-option").text($(".link_Tab .btn-group.select:eq(1) .dropdown-menu li:first").text())});$("select#pageLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"});$("select#pageLinksDropdown").change(function(){$("select#internalLinksDropdown option").attr("selected",false);$(".link_Tab .btn-group.select:eq(0) .dropdown-menu li").removeClass("selected");$(".link_Tab .btn-group.select:eq(0) > button .filter-option").text($(".link_Tab .btn-group.select:eq(0) .dropdown-menu li:first").text())});$("input#internalLinksCustom").focus(function(){$("select#internalLinksDropdown option").attr("selected",false);$("select#pageLinksDropdown option").attr("selected",false);$(".link_Tab .dropdown-menu li").removeClass("selected");$(".link_Tab .btn-group.select > button .filter-option").text($(".link_Tab .dropdown-menu li:first").text());this.select()});$("#detailsAppliedMessageHide").click(function(){$(this).parent().fadeOut(500)});if(typeof editableItems==="undefined"){$("#modeStyle").parent().remove()}$("#closeStyling").click(function(){closeStyleEditor()});$("#styleEditor form").on("focus","input",function(){$(this).css("position","absolute");$(this).css("right","0px");$(this).animate({width:"100%"},500);$(this).focus(function(){this.select()})}).on("blur","input",function(){$(this).animate({width:"42%"},500,function(){$(this).css("position","relative");$(this).css("right","auto")})});$("#menu #second ul>li").each(function(){$(this).find("iframe").zoomer({zoom:0.25,width:270,height:$(this).attr("height"),message:"Перетащи меня!"});makeDraggable("#page1")});$("#menu").mouseenter(function(){$(this).stop().animate({left:"0px"},500)}).mouseleave(function(){$(this).stop().animate({left:"-190px"},500)});makeSortable($("#pageList ul#page1"));$("#menu #main #elements").on("click","a:not(.btn)",function(){$("#menu #main a").removeClass("active");$(this).addClass("active");$("#menu #second ul li").hide();$("#menu #second ul li."+$(this).attr("id")).show();if($(this).attr("id")=="all"){$("#menu #second ul li").show()}$(".menu .second").css("display","block").stop().animate({width:secondMenuWidth},500)});$("#menu").mouseleave(function(){$("#menu #main a").removeClass("active");$(".menu .second").stop().animate({width:0},500,function(){$("#menu #second").hide()})});$("#menu #main").on("click","a:not(.actionButtons)",function(f){f.preventDefault()});$("#menu").mouseleave(function(){$("#menu #main a").removeClass("active");$(".menu .second").stop().animate({width:0},500,function(){$("#menu #second").hide()})});$("#hideSecond").on("click",function(){$(".menu .second").stop().animate({width:0},500,function(){$("#menu #second").hide()})});$("input:radio[name=mode]").parent().addClass("disabled");$("input:radio[name=mode]#modeBlock").radio("check");var b;$("input:radio[name=mode]").on("toggle",function(){closeStyleEditor();$("#pageList ul .frameCover").each(function(){$(this).hide()});$("#pageList ul li iframe").each(function(){for(var f in editableItems){$(this).contents().find(pageContainer+" "+f).unbind("hover").unbind("click")}});if($(this).val()=="content"){$("#pageList ul li iframe").each(function(){for(i=0;i<editableContent.length;++i){$(this).contents().find(pageContainer+" "+editableContent[i]).unbind("click").unbind("hover");$(this).contents().find(pageContainer+" "+editableContent[i]).hover(function(){$(this).css({outline:"3px dashed red",cursor:"pointer"})},function(){$(this).css({outline:"",cursor:""})}).click(function(f){b=$(this);f.preventDefault();f.stopPropagation();$("#editContentModal #contentToEdit").val($(this).html());$("#editContentModal").modal("show");if(this.tagName=="SMALL"||this.tagName=="A"||this.tagName=="LI"||this.tagName=="SPAN"||this.tagName=="B"||this.tagName=="I"||this.tagName=="TT"||this.tageName=="CODE"||this.tagName=="EM"||this.tagName=="STRONG"||this.tagName=="SUB"||this.tagName=="BUTTON"||this.tagName=="LABEL"||this.tagName=="P"||this.tagName=="H1"||this.tagName=="H2"||this.tagName=="H2"||this.tagName=="H3"||this.tagName=="H4"||this.tagName=="H5"||this.tagName=="H6"){$("#editContentModal #contentToEdit").redactor({buttons:["html","bold","italic","deleted"],focus:true,plugins:["bufferbuttons"],buttonSource:true,paragraphize:false,linebreaks:true})}else{if(this.tagName=="DIV"&&$(this).hasClass("tableWrapper")){$("#editContentModal #contentToEdit").redactor({buttons:["html","formatting","bold","italic","deleted","table","image","link","alignment"],focus:true,plugins:["table","bufferbuttons"],buttonSource:true,paragraphize:false,linebreaks:false})}else{$("#editContentModal #contentToEdit").redactor({buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","file","link","alignment","horizontalrule"],focus:true,buttonSource:true,paragraphize:false,linebreaks:false})}}}).each(function(){$(this).attr("data-selector",i)})}})}else{if($(this).val()=="block"){$("#pageList ul .frameCover").each(function(){$(this).show()});$("#pageList ul li iframe").each(function(){for(var f in editableItems){$(this).contents().find(pageContainer+" "+f).unbind("mouseenter mouseleave")}this.contentDocument.designMode="off"})}else{if($(this).val()=="styling"){$("#pageList ul li iframe").each(function(){$(this).contents().find(pageContainer+" p").unbind("click").unbind("hover");for(var f in editableItems){$(this).contents().find(pageContainer+" "+f).hover(function(g){g.stopPropagation();if($(this).closest("body").width()!=$(this).width()){$(this).css({outline:"3px dashed red",cursor:"pointer"})}else{$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}},function(){$(this).css({outline:"",cursor:"","outline-offset":""})}).click(function(g){g.preventDefault();g.stopPropagation();styleClick(this,f)}).each(function(){$(this).attr("data-selector",f)})}})}}}});$("button#updateContentInFrameSubmit").click(function(){b.html($("#editContentModal #contentToEdit").redactor("code.get")).css({outline:"",cursor:""});sandboxID=hasSandbox(b);if(sandboxID){elementID=b.attr("id");$("#"+sandboxID).contents().find("#"+elementID).html($("#editContentModal #contentToEdit").redactor("code.get"))}$("#editContentModal textarea").each(function(){$(this).redactor("core.destroy");$(this).val("")});$("#editContentModal").modal("hide");$(this).closest("body").removeClass("modal-open").attr("style","");heightAdjustment(b.get(0));setPendingChanges(true)});$("#styleEditor > a.close").click(function(f){f.preventDefault();closeStyleEditor()});var a;$("#pageList").on("click",".frameCover > .deleteBlock",function(){$("#deleteBlock").modal("show");a=$(this).closest("li");$("#deleteBlock").off("click","#deleteBlockConfirm").on("click","#deleteBlockConfirm",function(){var f=a.find("iframe").attr("data-sandbox");if(typeof f!==typeof undefined&&f!==false){$("#sandboxes #"+f).remove()}$("#deleteBlock").modal("hide");a.fadeOut(500,function(){$(this).remove();pageEmpty();allEmpty();setPendingChanges(true)})})});$("#pageList").on("click",".frameCover > .resetBlock",function(){$("#resetBlock").modal("show");frameToReset=$(this).closest("li").find("iframe");$("#resetBlock").off("click","#resetBlockConfirm").on("click","#resetBlockConfirm",function(){$("#resetBlock").modal("hide");frameToReset.get(0).contentWindow.location.reload();var f=frameToReset.attr("data-sandbox");if(typeof f!==typeof undefined&&f!==false){document.getElementById(f).contentDocument.location.reload(true)}})});var e=new Array();$("#pageList").on("click",".frameCover > .htmlBlock",function(){$(this).closest(".li").find("iframe").hide();$(this).closest("li").parent().sortable("disable");theEditor=$('<div class="aceEditor"></div>');theEditor.uniqueId();if($(this).closest("li").height()<300){$(this).closest("li").height(300);theEditor.height(300)}else{theEditor.height($(this).closest("li").height())}$(this).closest("li").append(theEditor);theId=theEditor.attr("id");var g=ace.edit(theId);var f=$(this).closest("li").find("iframe").attr("data-sandbox");if(typeof f!==typeof undefined&&f!==false){g.setValue($("#sandboxes #"+f).contents().find(pageContainer).html());document.getElementById(f).contentDocument.location.reload(true)}else{g.setValue($(this).closest("li").find("iframe").contents().find(pageContainer).html())}g.setTheme("ace/theme/twilight");g.getSession().setMode("ace/mode/html");cancelButton=$('<button type="button" class="btn btn-danger editCancelButton btn-wide"><span class="fui-cross"></span> Отмена</button>');saveButton=$('<button type="button" class="btn btn-primary editSaveButton btn-wide"><span class="fui-check"></span> Сохранить</button>');buttonWrapper=$('<div class="editorButtons"></div>');buttonWrapper.append(cancelButton);buttonWrapper.append(saveButton);$(this).closest("li").append(buttonWrapper);e[theId]=g});$("#pageList").on("click","li .editorButtons .editCancelButton",function(){heightAdjustment($(this).closest("li").find("iframe").attr("id"),true);$(this).closest("li").parent().sortable("enable");$(this).parent().prev().remove();$(this).closest("li").find(".zoomer-small iframe").fadeIn(500);$(this).parent().fadeOut(500,function(){$(this).remove()})});$("#pageList").on("click","li .editorButtons .editSaveButton",function(){$(this).closest("li").parent().sortable("enable");theId=$(this).closest(".editorButtons").prev().attr("id");theContent=e[theId].getValue();theiFrame=$(this).closest("li").find("iframe");$(this).parent().prev().remove();var f=$(this).closest("li").find("iframe").attr("data-sandbox");if(typeof f!==typeof undefined&&f!==false){$("#sandboxes #"+f).contents().find(pageContainer).html(theContent);$(this).closest("li").find("iframe").show().contents().find(pageContainer).html(theContent);if(typeof theiFrame.attr("data-loaderfunction")!==typeof undefined&&theiFrame.attr("data-loaderfunction")!==false){var g="theiFrame[0].contentWindow."+theiFrame.attr("data-loaderfunction")+"()";var h=new Function(g);h()}}else{$(this).closest("li").find("iframe").show().contents().find(pageContainer).html(theContent)}heightAdjustment($(this).closest("li").find("iframe").attr("id"),true);$(this).parent().fadeOut(500,function(){$(this).remove()});setPendingChanges(true)});$("#savePage").click(function(f){f.preventDefault();savePage(f)});$("#previewModal").on("show.bs.modal",function(f){$("#previewModal > form #showPreview").show("");$("#previewModal > form #previewCancel").text("Закрыть");closeStyleEditor()});$("#previewModal").on("shown.bs.modal",function(f){$('#previewModal form input[type="hidden"]').remove();$("#pageList > ul:visible").each(function(){newDocMainParent=$("iframe#skeleton").contents().find(pageContainer);newDocMainParent.find("*").remove();$(this).find("iframe").each(function(){var g=$(this).attr("data-sandbox");if(typeof g!==typeof undefined&&g!==false){theContents=$("#sandboxes #"+g).contents().find(pageContainer)}else{theContents=$(this).contents().find(pageContainer)}theContents.find(".frameCover").each(function(){$(this).remove()});for(var h in editableItems){theContents.find(h).each(function(){$(this).removeAttr("data-selector");if($(this).attr("style")==""){$(this).removeAttr("style")}})}for(i=0;i<editableContent.length;++i){$(this).contents().find(editableContent[i]).each(function(){$(this).removeAttr("data-selector")})}toAdd=theContents.html();scripts=$(this).contents().find(pageContainer).find("script");if(scripts.size()>0){theIframe=document.getElementById("skeleton");scripts.each(function(){if($(this).text()!=""){var j=theIframe.contentWindow.document.createElement("script");j.type="text/javascript";j.innerHTML=$(this).text();theIframe.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(j)}else{if($(this).attr("src")!=null){var j=theIframe.contentWindow.document.createElement("script");j.type="text/javascript";j.src=$(this).attr("src");theIframe.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(j)}}})}newDocMainParent.append($(toAdd))});newInput=$('<input type="hidden" name="page" value="">');$("#previewModal form").prepend(newInput);newInput.val("<html>"+$("iframe#skeleton").contents().find("html").html()+"</html>")})});$("#previewModal > form").submit(function(){$("#previewModal > form #showPreview").hide("");$("#previewModal > form #previewCancel").text("Закрыть")});$("#xsDgnInput").on("change",function(){var f=this.value.match(/\.(.+)$/)[1];if($.inArray(f,["xs"])==-1){var g="Please upload save Project file!";$("#xsErrorModal .modal-body").html(g);$("#xsErrorModal").modal("show")}else{$("#xsclearCanvas").modal("show");$("#xsImpModal").modal("hide")}});$("#xsclearCanvasImport").on("click",function(){$("#xsImportForm").submit()});$("#exportModal").on("show.bs.modal",function(f){$("#exportModal > form #exportSubmit").show("");$("#exportModal > form #exportCancel").text("Отменить и закрыть");closeStyleEditor()});$("#exportModal").on("shown.bs.modal",function(f){$("#pageList > ul").each(function(){newDocMainParent=$("iframe#skeleton").contents().find(pageContainer);newDocMainParent.find("*").remove();$(this).find("iframe").each(function(){var g=$(this).attr("data-sandbox");if(typeof g!==typeof undefined&&g!==false){theContents=$("#sandboxes #"+g).contents().find(pageContainer)}else{theContents=$(this).contents().find(pageContainer)}theContents.find(".frameCover").each(function(){$(this).remove()});for(var h in editableItems){theContents.find(h).each(function(){$(this).removeAttr("data-selector");if($(this).attr("style")==""){$(this).removeAttr("style")}})}for(i=0;i<editableContent.length;++i){$(this).contents().find(editableContent[i]).each(function(){$(this).removeAttr("data-selector")})}toAdd=theContents.html();scripts=$(this).contents().find(pageContainer).find("script");if(scripts.size()>0){theIframe=document.getElementById("skeleton");scripts.each(function(){if($(this).text()!=""){var j=theIframe.contentWindow.document.createElement("script");j.type="text/javascript";j.innerHTML=$(this).text();theIframe.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(j)}else{if($(this).attr("src")!=null){var j=theIframe.contentWindow.document.createElement("script");j.type="text/javascript";j.src=$(this).attr("src");theIframe.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(j)}}})}newDocMainParent.append($(toAdd))});newInput=$('<input type="hidden" name="pages['+$("#pages li:eq("+($(this).index()+1)+") a:first").text()+']" value="">');$("#exportModal form").prepend(newInput);newInput.val("<html>"+$("iframe#skeleton").contents().find("html").html()+"</html>")})});$("#exportModal > form").submit(function(){$("#exportModal > form #exportSubmit").hide("");$("#exportModal > form #exportCancel").text("Закрыть")});$("#clearScreen").click(function(){$("#deleteAll").modal("show");$("#deleteAll").on("click","#deleteAllConfirm",function(){$("#deleteAll").modal("hide");$("#pageList ul:visible li").fadeOut(500,function(){$(this).remove();pageEmpty();allEmpty()});$("#sandboxes iframe").each(function(){$(this).remove()})});setPendingChanges(true)});$("#pages").on("blur","li > input",function(){if($(this).parent().find("a.plink").size()==0){theLink=$('<a href="#'+$(this).val()+'" class="plink">'+$(this).val()+"</a>");$(this).hide();$(this).closest("li").prepend(theLink);$(this).closest("li").removeClass("edit");$("#internalLinksDropdown option:eq("+$(this).parent().index()+")").text($(this).val()).attr("value",$(this).val()+".html");$("select#internalLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"});$(this).remove()}});$("#addPage").click(function(g){g.preventDefault();$("#pages li.active").each(function(){if($(this).find("input").size()>0){theLink=$('<a href="#">'+$(this).find("input").val()+"</a>");$(this).find("input").remove();$(this).prepend(theLink)}});$("#pages li").removeClass("active");newPageLI=$("#newPageLI").clone();newPageLI.css("display","block");newPageLI.find("input").val("page"+$("#pages li").size());newPageLI.attr("id","");$("ul#pages").append(newPageLI);theInput=newPageLI.find("input");theInput.focus();var f=theInput.val();theInput.val("");theInput.val(f);theInput.keyup(function(){$("#pageTitle span span").text($(this).val())});newPageLI.addClass("active").addClass("edit");newPageList=$("<ul></ul>");newPageList.css("display","block");newPageList.attr("id","page"+($("#pages li").size()-1));$("#pageList > ul").hide();$("#pageList").append(newPageList);makeSortable(newPageList);makeDraggable("#page"+($("#pages li").size()-1));$("#pageTitle span span").text("page"+($("#pages li").size()-1));$("#frameWrapper").addClass("empty");$("#start").fadeIn();newItem=$('<option value="page'+($("#pages li").size()-1)+'.html">page'+($("#pages li").size()-1)+"</option>");$("#internalLinksDropdown").append(newItem);$("select#internalLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"});setPendingChanges(true)});$("#pages").on("click","li:not(.active)",function(){$("#pageList > ul").hide();$("#pageList > ul:eq("+($(this).index()-1)+")").show();pageEmpty();makeDraggable("#page"+($(this).index()));$("#pages li").removeClass("active").removeClass("edit");$(this).addClass("active");$("#pageTitle span span").text($(this).find("a").text())});$("#pages").on("click","li.active .fileSave",function(){theLI=$(this).closest("li");if(theLI.find("input").size()>0){theLink=$('<a href="#'+theLI.find("input").val()+'">'+theLI.find("input").val()+"</a>");theLI.find("input").remove();theLI.prepend(theLink)}$("#pages li").removeClass("edit")});$("#pages").on("click","li.active .fileEdit",function(){theLI=$(this).closest("li");newInput=$('<input type="text" value="'+theLI.find("a:first").text()+'" name="page">');theLI.find("a:first").remove();theLI.prepend(newInput);newInput.focus();var f=newInput.val();newInput.val("");newInput.val(f);newInput.keyup(function(){$("#pageTitle span span").text($(this).val())});theLI.addClass("edit");setPendingChanges(true)});var d;$("#pages").on("click","li.active .fileDel",function(){d=$(this).parent().parent().index();$("#deletePage").modal("show");$("#deletePageCancel").click(function(){$("#deletePage").modal("hide")});$("#deletePage").off("click").on("click","#deletePageConfirm",function(f){$("#deletePage").modal("hide");$("#pages li:eq("+d+")").remove();$("#pageList ul:visible").remove();$("select#internalLinksDropdown option:eq("+d+")").remove();$(".link_Tab .dropdown-menu li:eq("+d+")").remove();$("#pages li:eq(1)").addClass("active");$("#pageList ul:first").show();$("#pageTitle span span").text($("#pages li:eq(1)").find("a:first").text());makeDraggable("#page1");pageEmpty();allEmpty();savePage(f);setPendingChanges(true)})});$("#editContentModal").on("hidden.bs.modal",function(f){$("#editContentModal #contentToEdit").redactor("core.destroy")})});function savePage(d){var f=[];closeStyleEditor();pageCounter=0;$("#pageList > ul").each(function(){f[pageCounter]={element:[],frame:[],page:[]};theName=$(this).attr("id");$(this).find("li").each(function(){f[pageCounter].frame.push($(this).html())});$(this).find("iframe").each(function(){var e=$(this).attr("data-sandbox");if(typeof e!==typeof undefined&&e!==false){theContents=$("#sandboxes #"+e).contents().find(pageContainer)}else{theContents=$(this).contents().find(pageContainer)}theContents.find(".frameCover").each(function(){$(this).remove()});for(var g in editableItems){theContents.find(g).each(function(){$(this).removeAttr("data-selector");if($(this).attr("style")==""){$(this).removeAttr("style")}})}for(i=0;i<editableContent.length;++i){$(this).contents().find(editableContent[i]).each(function(){$(this).removeAttr("data-selector")})}f[pageCounter].element.push(theContents.html())});pageCounter++});c=0;$("ul#pages li:not(#newPageLI)").each(function(e){f[c].page=$(this).find("a").text();c++});var b=$("#savePageForm");var a=b.attr("action");$.ajax({url:a,data:JSON.stringify({domain_id:$("#selectDomain").val(),blocks:f}),cache:false,contentType:false,processData:false,dataType:"json",type:"POST"}).done(function(g,e,h){if(h.status==401){$("#auth .modal").modal("show")}else{setPendingChanges(false)}}).fail(function(g,e,h){$("#auth .modal").modal("show")})};