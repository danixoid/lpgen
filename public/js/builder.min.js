var pageContainer="#page";var enablePreview=true;var editableItems=new Array();editableItems[".frameCover"]=[];editableItems["nav#main-navbar"]=["background-color","box-shadow"];editableItems["nav a"]=["font-weight","font-size","text-transform"];editableItems["nav a.btn-nav"]=["font-weight","font-size","background-color"];editableItems[".nav-callus"]=["color","font-weight","font-size","text-transform"];editableItems["a.edit"]=["color","font-weight","font-size","text-transform"];editableItems[".text-edit"]=["color","font-weight","font-size","text-transform","background-color"];editableItems.img=["border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius","border-color","border-style","border-width"];editableItems[".bg-img"]=["background-color"];editableItems.h1=["color","font-size","background-color","font-family","font-weight"];editableItems.h2=["color","font-size","background-color","font-family","font-weight"];editableItems.h3=["color","font-size","background-color","font-family","font-weight"];editableItems.h4=["color","font-size","background-color","font-family","font-weight"];editableItems.h5=["color","font-size","background-color","font-family","font-weight"];editableItems.h6=["color","font-size","background-color","font-family","font-weight"];editableItems.p=["color","font-size","background-color","font-family","font-weight"];editableItems["a.btn, button.btn, .btn"]=["border-radius","font-size","background-color","box-shadow","border-color","border-style","border-width"];editableItems[".bg-edit"]=["background-color"];editableItems[".block-edit"]=["background-image"];editableItems["i, span.fa"]=["color","font-size"];var editableItemOptions=new Array();editableItemOptions["nav a : font-weight"]=["700","300","400","900"];editableItemOptions["nav a.btn-nav : font-weight"]=["700","300","400","900"];editableItemOptions["img : border-style"]=["none","dotted","dashed","solid"];editableItemOptions["img : border-width"]=["1px","2px","3px","4px"];editableItemOptions["h1 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h2 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h3 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h4 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h5 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["h6 : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];editableItemOptions["p : font-family"]=["default","Arsenal","Helvetica","Arial","Times New Roman"];var editableContent=[".editContent",".navbar a","a.edit","h1:not(.no-edit)","h2:not(.no-edit)","h3:not(.no-edit)","h4:not(.no-edit)","h5:not(.no-edit)","h6:not(.no-edit)","p:not(.no-edit)",".nav-callus",".text-edit",".btn:not(.no-edit)",".footer a:not(.fa)",".tableWrapper"];$(function(){$(".nav-tabs a").on("click",function(a){a.preventDefault();$(this).tab("show")})});var mainMenuWidth=230;var secondMenuWidth=300;$(window).load(function(){$("#loader").fadeOut(function(){$("#menu").animate({left:"-190px"},1000)});if(enablePreview==true){$("#preview").show()}loadPagesByDomain($("#selectDomain").val());$("#selectDomain").on("change",function(a){loadPagesByDomain($("#selectDomain").val())});$("#auth").submit(function(b){var a=$(this);b.preventDefault();$.get("/_token",function(c){$.ajaxSetup({headers:{"X-CSRF-TOKEN":c._token}});$.ajax({url:a.attr("action"),data:a.serialize(),dataType:"json",type:"POST"}).done(function(d){$("#auth .modal").modal("hide");savePage(b)}).error(function(d){var e="";console.log(d.responseText);$.each(JSON.parse(d.responseText),function(f,g){e+=g+"\n"});alert(e)})})})});function loadPagesByDomain(a){var d=$("#getBlocksForm");var b=d.attr("action");var c=d.attr("method");$("#domainHidden").val(a);$.ajax({url:b+"?domain_id="+a,cache:false,contentType:false,processData:false,dataType:"json",type:c}).done(function(f){$("#pageList ul#page1").empty();$("#pageList ul.generate-ul").remove();$("ul#pages li.generate-li").remove();var g=[];for(x=0;x<f.length;x++){var h=x+1;if($("ul#page"+h).size()==0){newUL=$('<ul id="page'+h+'" class="generate-ul"></ul>');$("#pageList").append(newUL);makeSortable(newUL);newItem=$('<option value="/'+f[x].name+'">'+f[x].name+"</option>");$("#internalLinksDropdown").append(newItem)}for(var j=0;j<f[x].l_blocks.length;j++){$("#start").hide();if(f[x].l_blocks[j]!=null){toInsert=$("<li>"+f[x].l_blocks[j].frame+"</li>");toInsert.find("iframe").attr("id","ui-id-"+x+j);toInsert.find(".frameCover").show();var e=toInsert.find("iframe").attr("data-sandbox");if(typeof e!==typeof undefined&&e!==false){theiFrame=toInsert.find("iframe");theID=theiFrame.attr("data-sandbox");sandboxedFrame=$('<iframe src="'+theiFrame.attr("src")+'" id="'+theID+'" sandbox="allow-same-origin"></iframe>');$("#sandboxes").append(sandboxedFrame)}g[toInsert.find("iframe").attr("id")]=f[x].l_blocks[j].element;toInsert.find("iframe").load(function(){$(this).contents().find(pageContainer).html(g[$(this).attr("id")]);var k=$(this).attr("data-sandbox");if(typeof k!==typeof undefined&&k!==false){$("iframe#"+$(this).attr("data-sandbox")).contents().find(pageContainer).html(g[$(this).attr("id")]);theLoaderFunction=$(this).data("data-loaderfunction");theiFrame=$(this);var l="theiFrame[0].contentWindow."+theiFrame.attr("data-loaderfunction")+"()";var m=new Function(l);m()}});$("ul#page"+h).append(toInsert)}}if(h>1&&typeof f[x].name!="undefined"){newLI=$('<li class="generate-li"><a class="plink" href="#page'+h+'">'+f[x].name+'</a><span class="pageButtons"><a class="fileEdit" href=""><span class="fui-new"></span></a><a class="fileDel" href=""><span class="fui-cross"></span></a><a href="#" class="btn btn-xs btn-primary btn-embossed fileSave"><span class="fui-check"></span></a></span></li>');$("ul#pages").append(newLI)}}allEmpty()})}var hexDigits=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function rgb2hex(a){a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return"#"+hex(a[1])+hex(a[2])+hex(a[3])}function hex(a){return isNaN(a)?"00":hexDigits[(a-a%16)/16]+hexDigits[a%16]}function getRandomArbitrary(b,a){return Math.floor(Math.random()*(a-b)+b)}var pendingChanges=false;function setPendingChanges(a){if(a==true){$(window).bind("beforeunload",function(){return">>>>>Before You Go<<<<<<<< \n Your custom message go here"});$("#savePage .bLabel").text("Сохранить изменения (!)");pendingChanges=true}else{$(window).unbind("beforeunload");$("#savePage .bLabel").text("Сохранено");pendingChanges=false}}function pageEmpty(){if($("#pageList ul:visible > li").size()==0){$("#start").show();$("#frameWrapper").addClass("empty")}else{$("#start").hide();$("#frameWrapper").removeClass("empty")}}function allEmpty(){var a=false;if($("#pageList li").size()==0){a=true}else{a=false}if(a){$("a.actionButtons").each(function(){$(this).addClass("disabled")});$("header .modes input").each(function(){$(this).prop("disabled",true).parent().addClass("disabled")})}else{$("header .modes input").each(function(){$(this).prop("disabled",false).parent().removeClass("disabled")});$("a.actionButtons").each(function(){$(this).removeClass("disabled")})}}function makeDraggable(a){$("#second #elements li").each(function(){$(this).draggable({helper:function(){return $('<div style="height: 100px; width: 300px; background: #F9FAFA; box-shadow: 5px 5px 1px rgba(0,0,0,0.1); text-align: center; line-height: 100px; font-size: 28px; color: #16A085"><span class="fui-list"></span></div>')},revert:"invalid",appendTo:"body",connectToSortable:a,stop:function(){pageEmpty();allEmpty()},start:function(){$("input:radio[name=mode]").parent().addClass("disabled");$("input:radio[name=mode]#modeBlock").radio("check");$("#pageList ul .zoomer-wrapper .zoomer-cover").each(function(){$(this).show()});$("#pageList ul li iframe").each(function(){this.contentDocument.designMode="off"})}})});$("#elements li a").each(function(){$(this).unbind("click").bind("click",function(b){b.preventDefault()})})}var frameContents="";function makeSortable(a){a.sortable({revert:true,placeholder:"drop-hover",handle:".frameCover",beforeStop:function(d,e){var c=100;var b="";if(e.item.find(".frameCover").size()==0){if(e.item.find("iframe").size()>0){c=e.item.height();if(c<50){c=100}b=e.item.find("iframe").attr("data-sandbox");if(typeof b!==typeof undefined&&b!==false){theID=getRandomArbitrary(10000,1000000000);sandboxedFrame=$('<iframe src="'+e.item.find("iframe").attr("src")+'" id="'+theID+'" sandbox="allow-same-origin"></iframe>');$("#sandboxes").append(sandboxedFrame);if(typeof e.item.find("iframe").attr("data-loaderfunction")!==typeof undefined&&e.item.find("iframe").attr("data-loaderfunction")!==false){loaderFunction_='data-loaderfunction="'+e.item.find("iframe").attr("data-loaderfunction")+'"'}e.item.html('<iframe src="'+e.item.find("iframe").attr("src")+'" scrolling="no" frameborder="0" data-sandbox="'+theID+'" '+loaderFunction_+"><iframe>")}else{e.item.html('<iframe src="'+e.item.find("iframe").attr("src")+'" scrolling="no" frameborder="0"><iframe>')}e.item.find("iframe").uniqueId();e.item.find("iframe").height(c+"px")}else{c=e.item.find("img").attr("data-height");if(c<50){c=100}b=e.item.find("img").attr("data-sandbox");if(typeof b!==typeof undefined&&b!==false){theID=getRandomArbitrary(10000,1000000000);sandboxedFrame=$('<iframe src="'+e.item.find("img").attr("data-srcc")+'" id="'+theID+'" sandbox="allow-same-origin"></iframe>');$("#sandboxes").append(sandboxedFrame);if(typeof e.item.find("img").attr("data-loaderfunction")!==typeof undefined&&e.item.find("img").attr("data-loaderfunction")!==false){loaderFunction_='data-loaderfunction="'+e.item.find("img").attr("data-loaderfunction")+'"'}e.item.html('<iframe src="'+e.item.find("img").attr("data-srcc")+'" scrolling="no" frameborder="0" data-sandbox="'+theID+'" '+loaderFunction_+"><iframe>")}else{e.item.html('<iframe src="'+e.item.find("img").attr("data-srcc")+'" scrolling="no" frameborder="0"><iframe>')}e.item.find("iframe").uniqueId();e.item.find("iframe").height(c+"px");e.item.find("iframe").css("background","#ffffff url(images/loading.gif) 50% 50% no-repeat");e.item.find("iframe").load(function(){heightAdjustment(e.item.find("iframe").attr("id"),true)})}delButton=$('<button type="button" class="btn btn-danger deleteBlock"><span class="fui-trash"></span> Удалить</button>');resetButton=$('<button type="button" class="btn btn-warning resetBlock"><i class="fa fa-refresh"></i> Сброс</button>');htmlButton=$('<button type="button" class="btn btn-inverse htmlBlock"><i class="fa fa-code"></i> Код</button>');frameCover=$('<div class="frameCover"></div>');frameCover.append(delButton);frameCover.append(resetButton);frameCover.append(htmlButton);e.item.append(frameCover)}else{e.item.find("iframe").load(function(){$(this).contents().find(pageContainer).html(frameContents)})}setPendingChanges(true)},stop:function(){$("#pageList ul:visible li").each(function(){$(this).find(".zoomer-cover > a").remove()})},start:function(b,c){if(c.item.find(".frameCover").size()!=0){frameContents=c.item.find("iframe").contents().find(pageContainer).html()}},over:function(){$("#start").hide()}})}function buildeStyleElements(c,e){for(x=0;x<editableItems[e].length;x++){var b=$("#styleElTemplate").clone();b.attr("id","");b.find(".control-label").text(editableItems[e][x]+":");if(e+" : "+editableItems[e][x] in editableItemOptions){b.find("input").remove();var a=$("<select></select>");a.attr("name",editableItems[e][x]);for(z=0;z<editableItemOptions[e+" : "+editableItems[e][x]].length;z++){var d=$('<option value="'+editableItemOptions[e+" : "+editableItems[e][x]][z]+'">'+editableItemOptions[e+" : "+editableItems[e][x]][z]+"</option>");if(editableItemOptions[e+" : "+editableItems[e][x]][z]==$(c).css(editableItems[e][x])){d.attr("selected","true")}a.append(d)}b.append(a);a.selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"})}else{b.find("input").val($(c).css(editableItems[e][x])).attr("name",editableItems[e][x]);if(editableItems[e][x].indexOf("color")>-1){if($(c).css(editableItems[e][x])!="transparent"&&$(c).css(editableItems[e][x])!="none"&&$(c).css(editableItems[e][x])!=""){b.val($(c).css(editableItems[e][x]))}b.find("input").spectrum({preferredFormat:"hex",showPalette:true,allowEmpty:true,showInput:true,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]]})}}b.css("display","block");$("#styleElements").append(b);$("#styleEditor form#stylingForm").height("auto")}}function getParentFrameID(b){var a="";$("#pageList li:visible iframe").each(function(){var c=$(this).contents().find("body");if($.contains(document.getElementById($(this).attr("id")).contentWindow.document,b)){a=$(this).attr("id")}});if(a!=""){return a}}function heightAdjustment(d,c){var a;c=typeof c!=="undefined"?c:false;if(c==false){$("#pageList li:visible iframe").each(function(){var e=$(this).contents().find("body");if($.contains(document.getElementById($(this).attr("id")).contentWindow.document,d)){var f=$(this).attr("id")}});a=document.getElementById(frameID)}else{a=document.getElementById(d)}var b=a.contentWindow.document.body.offsetHeight;if(b<50){b=100}$(a).height(b+"px");$(a).parent().height((b)+"px");$(a).next().height((b)+"px")}function hasSandbox(b){var a=$("#"+getParentFrameID(b.get(0))).attr("data-sandbox");if(typeof a!==typeof undefined&&a!==false){return a}else{return false}}var _oldIcon=[];function styleClick(b){var k=$(b).attr("data-selector");$("#editingElement").text(k);$("#detailTabs a:first").click();$("a#link_Link").parent().hide();$("a#img_Link").parent().hide();$("a#icon_Link").parent().hide();$("a#video_Link").parent().hide();if($(b).prop("tagName")=="A"||$(b).parent().prop("tagName")=="A"){var f;$("a#link_Link").parent().show();if($(b).prop("tagName")=="A"){f=$(b).attr("href")}else{if($(b).parent().prop("tagName")=="A"){f=$(b).parent().attr("href")}}var h=0;var d=false;$("select#internalLinksDropdown").prop("selectedIndex",0);$("select#internalLinksDropdown option").each(function(){if($(this).attr("value")==f){$(this).attr("selected",true);h=$(this).index();d=true}});$(".link_Tab .btn-group.select .dropdown-menu li").removeClass("selected");$(".link_Tab .btn-group.select .dropdown-menu li:eq("+h+")").addClass("selected");$(".link_Tab .btn-group.select:eq(0) .filter-option").text($("select#internalLinksDropdown option:selected").text());$(".link_Tab .btn-group.select:eq(1) .filter-option").text($("select#pageLinksDropdown option:selected").text());if(d==true){$("input#internalLinksCustom").val("")}else{if($(b).prop("tagName")=="A"){if($(b).attr("href")[0]!="#"){$("input#internalLinksCustom").val($(b).attr("href"))}else{$("input#internalLinksCustom").val("")}}else{if($(b).parent().prop("tagName")=="A"){if($(b).parent().attr("href")[0]!="#"){$("input#internalLinksCustom").val($(b).parent().attr("href"))}else{$("input#internalLinksCustom").val("")}}}}$("select#pageLinksDropdown option:not(:first)").remove();$("#pageList ul:visible iframe").each(function(){if($(this).contents().find(pageContainer+" > *:first").attr("id")!=undefined){if($(b).attr("href")=="#"+$(this).contents().find(pageContainer+" > *:first").attr("id")){newOption="<option selected value=#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+">#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+"</option>"}else{newOption="<option value=#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+">#"+$(this).contents().find(pageContainer+" > *:first").attr("id")+"</option>"}$("select#pageLinksDropdown").append(newOption)}})}if($(b).attr("data-type")=="video"){$("a#video_Link").parent().show();$("a#video_Link").click();if($(b).prev().attr("src").indexOf("vimeo.com")>-1){e=$(b).prev().attr("src").match(/player\.vimeo\.com\/video\/([0-9]*)/);$("#video_Tab input#vimeoID").val(e[e.length-1]);$("#video_Tab input#youtubeID").val("")}else{var g=/.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/;var e=$(b).prev().attr("src").match(g);$("#video_Tab input#youtubeID").val(e[1]);$("#video_Tab input#vimeoID").val("")}}if($(b).prop("tagName")=="IMG"){$("a#img_Link").parent().show();$(".imageFileTab").find("a.fileinput-exists").click();var j=$(b).attr("src");var a=$('<img src="'+j+'" />');$(".imageFileTab").find(".fileinput-preview").append(a);$(".imageFileTab").find("input#imageURL").val($(b).attr("src"))}if($(b).hasClass("bg-img")){$(".imageFileTab").find("a.fileinput-exists").click();var j=$(b).css("background-image").match(/https?:\/\/[^\"]+/gi)[0];var a=$('<img src="'+j+'"/>');$("a#img_Link").parent().show();$(".imageFileTab").find("input#imageURL").val(j);$(".imageFileTab").find(".fileinput-preview ").append(a)}if($(b).hasClass("fa")){$("a#icon_Link").parent().show();var c=$.grep(b.className.split(" "),function(l,m){return l.indexOf("fa-")===0}).join();$("select#icons option").each(function(){if($(this).val()==c){$(this).attr("selected",true);$("#icons").trigger("chosen:updated")}})}$("#pageList ul:visible li iframe").each(function(){for(var l in editableItems){$(this).contents().find(pageContainer+" "+l).css({outline:"none",cursor:"default"});$(this).contents().find(pageContainer+" "+l).hover(function(m){m.stopPropagation();if($(this).closest("body").width()!=$(this).width()){$(this).css({outline:"3px dashed red",cursor:"pointer"})}else{$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}},function(){if($(this).closest("body").width()!=($(this).width()+6)){$(this).css({outline:"",cursor:""})}else{$(this).css({border:"",cursor:"","outline-offset":""})}})}});$(b).unbind("mouseenter mouseleave");if($(b).closest("body").width()!=$(b).width()){$(b).css({outline:"3px dashed red",cursor:"pointer"})}else{$(b).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}$("#styleElements > *:not(#styleElTemplate)").each(function(){$(this).remove()});buildeStyleElements(b,k);if($("#styleEditor").css("left")=="-300px"){$("#styleEditor").animate({left:"0px"},250)}$("button#saveStyling").unbind("click").bind("click",function(){var p;var m;$("#styleEditor #tab1 .form-group:not(#styleElTemplate) input, #styleEditor #tab1 .form-group:not(#styleElTemplate) select").each(function(){$(b).css($(this).attr("name"),$(this).val());p=hasSandbox($(b));if(p){m=$(b).attr("id");$("#"+p).contents().find("#"+m).css($(this).attr("name"),$(this).val())}});if($(b).prop("tagName")=="A"){if($("select#internalLinksDropdown").val()!="#"){$(b).attr("href",$("select#internalLinksDropdown").val())}else{if($("select#pageLinksDropdown").val()!="#"){$(b).attr("href",$("select#pageLinksDropdown").val())}else{if($("input#internalLinksCustom").val()!=""){$(b).attr("href",$("input#internalLinksCustom").val())}}}p=hasSandbox($(b));if(p){m=$(b).attr("id");if($("select#internalLinksDropdown").val()!="#"){$("#"+p).contents().find("#"+m).attr("href",$("select#internalLinksDropdown").val())}else{if($("select#pageLinksDropdown").val()!="#"){$("#"+p).contents().find("#"+m).attr("href",$("select#pageLinksDropdown").val())}else{if($("input#internalLinksCustom").val()!=""){$("#"+p).contents().find("#"+m).attr("href",$("input#internalLinksCustom").val())}}}}}if($(b).parent().prop("tagName")=="A"){if($("select#internalLinksDropdown").val()!="#"){$(b).parent().attr("href",$("select#internalLinksDropdown").val())}else{if($("select#pageLinksDropdown").val()!="#"){$(b).parent().attr("href",$("select#pageLinksDropdown").val())}else{if($("input#internalLinksCustom").val()!=""){$(b).parent().attr("href",$("input#internalLinksCustom").val())}}}p=hasSandbox($(b));if(p){m=$(b).attr("id");if($("select#internalLinksDropdown").val()!="#"){$("#"+p).contents().find("#"+m).parent().attr("href",$("select#internalLinksDropdown").val())}else{if($("select#pageLinksDropdown").val()!="#"){$("#"+p).contents().find("#"+m).parent().attr("href",$("select#pageLinksDropdown").val())}else{if($("input#internalLinksCustom").val()!=""){$("#"+p).contents().find("#"+m).parent().attr("href",$("input#internalLinksCustom").val())}}}}}if($("a#img_Link").css("display")=="block"&&$("input#imageFileField").val()!=""){var q=$("form#imageUploadForm");var l=false;if(window.FormData){l=new FormData(q[0])}var n=q.attr("action");$.ajax({url:n,data:l?l:q.serialize(),cache:false,contentType:false,processData:false,dataType:"json",type:"POST"}).done(function(s,r){if(r==401){$("#auth.modal").modal("show")}else{if(s.code==1){$("input#imageURL").val(s.response);if($(b).hasClass("bg-img")){var t="url('"+s.response+"')";$(b).css("background-image",t);$(b).css("-webkit-background-size","cover");$(b).css("-moz-background-size","cover");$(b).css("background-size","cover");$(b).css("background-repeat","no-repeat");$(b).css("background-position","center center");$(b).css("background-attachment","scroll")}else{$(b).attr("src",s.response)}$(".imageFileTab").find("a.fileinput-exists").click();p=hasSandbox($(b));if(p){m=$(b).attr("id");$("#"+p).contents().find("#"+m).attr("src",s.response)}}else{if(s.code==0){alert("Something went wrong: "+s.response)}}}})}else{if($("a#img_Link").css("display")=="block"){if($("input#imageURL").val()!=""&&$("input#imageURL").val()!=$(b).attr("src")){$(b).attr("src",$("input#imageURL").val());p=hasSandbox($(b));if(p){m=$(b).attr("id");$("#"+p).contents().find("#"+m).attr("src",$("input#imageURL").val())}}}}if($(b).hasClass("fa")){var o=$.grep(b.className.split(" "),function(r,s){return r.indexOf("fa-")===0}).join();if(o!=$("select#icons").val()){$(b).uniqueId();_oldIcon[$(b).attr("id")]=o}$(b).removeClass(o).addClass($("select#icons").val());p=hasSandbox($(b));if(p){m=$(b).attr("id");$("#"+p).contents().find("#"+m).removeClass(o).addClass($("select#icons").val())}}if($(b).attr("data-type")=="video"){if($("input#youtubeID").val()!=""){$(b).prev().attr("src","//www.youtube.com/embed/"+$("#video_Tab input#youtubeID").val())}else{if($("input#vimeoID").val()!=""){$(b).prev().attr("src","//player.vimeo.com/video/"+$("#video_Tab input#vimeoID").val()+"?title=0&amp;byline=0&amp;portrait=0")}}p=hasSandbox($(b));if(p){m=$(b).attr("id");if($("input#youtubeID").val()!=""){$("#"+p).contents().find("#"+m).prev().attr("src","//www.youtube.com/embed/"+$("#video_Tab input#youtubeID").val())}else{if($("input#vimeoID").val()!=""){$("#"+p).contents().find("#"+m).prev().attr("src","//player.vimeo.com/video/"+$("#video_Tab input#vimeoID").val()+"?title=0&amp;byline=0&amp;portrait=0")}}}}$("#detailsAppliedMessage").fadeIn(600,function(){setTimeout(function(){$("#detailsAppliedMessage").fadeOut(1000)},3000)});heightAdjustment(b);setPendingChanges(true)});$("button#removeElementButton").unbind("click").bind("click",function(){var m;var l;if($(b).prop("tagName")=="A"){if($(b).parent().prop("tagName")=="LI"){m=$(b).parent()}else{m=$(b)}}else{if($(b).prop("tagName")=="IMG"){if($(b).parent().prop("tagName")=="A"){m=$(b).parent()}else{m=$(b)}}else{m=$(b)}}$("#styleEditor").on("click","button#removeElementButton",function(){$("#deleteElement").modal("show");$("#deleteElement button#deleteElementConfirm").unbind("click").bind("click",function(){m.fadeOut(500,function(){l=$(this).closest("body").find("*:first");m.remove();heightAdjustment(l[0])});$("#deleteElement").modal("hide");closeStyleEditor()})})});$("button#cloneElementButton").unbind("click").bind("click",function(){var m;var p;var l;var o;if($(b).parent().hasClass("propClone")){m=$(b).parent().clone();m.find($(b).prop("tagName")).attr("style","");p=m.find($(b).prop("tagName"));l=$(b).parent();o=$(b).parent().parent()}else{m=$(b).clone();m.attr("style","");p=m;l=$(b);o=$(b).parent()}l.after(m);for(var n in editableItems){$(b).closest("body").find(pageContainer+" "+n).each(function(){if($(this)[0]===$(p)[0]){p.hover(function(){if($(this).closest("body").width()!=$(this).width()){$(this).css({outline:"3px dashed red",cursor:"pointer"})}else{$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}},function(){if($(this).closest("body").width()!=($(this).width()+6)){$(this).css({outline:"",cursor:""})}else{$(this).css({outline:"",cursor:"","outline-offset":""})}}).click(function(q){q.preventDefault();q.stopPropagation();styleClick(this,n)}).each(function(){$(this).attr("data-selector",n)})}})}heightAdjustment(b)});$("button#resetStyleButton").unbind("click").bind("click",function(){if($(b).closest("body").width()!=$(b).width()){$(b).attr("style","").css({outline:"3px dashed red",cursor:"pointer"})}else{$(b).attr("style","").css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}$("#styleEditor form#stylingForm").height($("#styleEditor form#stylingForm").height()+"px");$("#styleEditor form#stylingForm .form-group:not(#styleElTemplate)").fadeOut(500,function(){$(this).remove()});if(_oldIcon[$(b).attr("id")]!=null){var l=$.grep(b.className.split(" "),function(m,n){return m.indexOf("fa-")===0}).join();$(b).removeClass(l).addClass(_oldIcon[$(b).attr("id")]);$("select#icons option").each(function(){if($(this).val()==_oldIcon[$(b).attr("id")]){$(this).attr("selected",true);$("#icons").trigger("chosen:updated")}})}setTimeout(function(){buildeStyleElements(b,k)},550)})}function closeStyleEditor(){if($("#styleEditor").css("left")=="0px"){$("#styleEditor").animate({left:"-300px"},250);$("#pageList ul li iframe").each(function(){for(var a in editableItems){$(this).contents().find(pageContainer+" "+a).unbind("mouseenter mouseleave click").css({outline:"",cursor:""})}if($("input:radio[name=mode]:checked").val()=="styling"){$("#pageList ul li iframe").each(function(){for(var b in editableItems){$(this).contents().find(pageContainer+" "+b).hover(function(c){c.stopPropagation();if($(this).closest("body").width()!=$(this).width()){$(this).css({outline:"3px dashed red",cursor:"pointer"})}else{$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}},function(){if($(this).closest("body").width()!=($(this).width()+6)){$(this).css({outline:"",cursor:""})}else{$(this).css({outline:"",cursor:"","outline-offset":""})}}).click(function(c){c.preventDefault();c.stopPropagation();styleClick(this,b)})}})}})}}$(function(){var d;$("input#youtubeID").focus(function(){$("input#vimeoID").val("")});$("input#vimeoID").focus(function(){$("input#youtubeID").val("")});$("select#icons").chosen({search_contains:true});if(window.location.protocol=="file:"){d="local"}else{d="server"}if(!window.FormData){$("form#imageUploadForm").hide();$(".imageFileTab .or").hide()}$("select#internalLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"});$("select#internalLinksDropdown").change(function(){$("select#pageLinksDropdown option").attr("selected",false);$(".link_Tab .btn-group.select:eq(1) .dropdown-menu li").removeClass("selected");$(".link_Tab .btn-group.select:eq(1) > button .filter-option").text($(".link_Tab .btn-group.select:eq(1) .dropdown-menu li:first").text())});$("select#pageLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"});$("select#pageLinksDropdown").change(function(){$("select#internalLinksDropdown option").attr("selected",false);$(".link_Tab .btn-group.select:eq(0) .dropdown-menu li").removeClass("selected");$(".link_Tab .btn-group.select:eq(0) > button .filter-option").text($(".link_Tab .btn-group.select:eq(0) .dropdown-menu li:first").text())});$("input#internalLinksCustom").focus(function(){$("select#internalLinksDropdown option").attr("selected",false);$("select#pageLinksDropdown option").attr("selected",false);$(".link_Tab .dropdown-menu li").removeClass("selected");$(".link_Tab .btn-group.select > button .filter-option").text($(".link_Tab .dropdown-menu li:first").text());this.select()});$("#detailsAppliedMessageHide").click(function(){$(this).parent().fadeOut(500)});if(typeof editableItems==="undefined"){$("#modeStyle").parent().remove()}$("#closeStyling").click(function(){closeStyleEditor()});$("#styleEditor form").on("focus","input",function(){$(this).css("position","absolute");$(this).css("right","0px");$(this).animate({width:"100%"},500);$(this).focus(function(){this.select()})}).on("blur","input",function(){$(this).animate({width:"42%"},500,function(){$(this).css("position","relative");$(this).css("right","auto")})});$("#menu #second ul>li").each(function(){$(this).find("iframe").zoomer({zoom:0.25,width:270,height:$(this).attr("height"),message:"Перетащи меня!"});makeDraggable("#page1")});$("#menu").mouseenter(function(){$(this).stop().animate({left:"0px"},500)}).mouseleave(function(){$(this).stop().animate({left:"-190px"},500)});makeSortable($("#pageList ul#page1"));$("#menu #main #elements").on("click","a:not(.btn)",function(){$("#menu #main a").removeClass("active");$(this).addClass("active");$("#menu #second ul li").hide();$("#menu #second ul li."+$(this).attr("id")).show();if($(this).attr("id")=="all"){$("#menu #second ul li").show()}$(".menu .second").css("display","block").stop().animate({width:secondMenuWidth},500)});$("#menu").mouseleave(function(){$("#menu #main a").removeClass("active");$(".menu .second").stop().animate({width:0},500,function(){$("#menu #second").hide()})});$("#menu #main").on("click","a:not(.actionButtons)",function(f){f.preventDefault()});$("#menu").mouseleave(function(){$("#menu #main a").removeClass("active");$(".menu .second").stop().animate({width:0},500,function(){$("#menu #second").hide()})});$("#hideSecond").on("click",function(){$(".menu .second").stop().animate({width:0},500,function(){$("#menu #second").hide()})});$("input:radio[name=mode]").parent().addClass("disabled");$("input:radio[name=mode]#modeBlock").radio("check");var b;$("input:radio[name=mode]").on("toggle",function(){closeStyleEditor();$("#pageList ul .frameCover").each(function(){$(this).hide()});$("#pageList ul li iframe").each(function(){for(var f in editableItems){$(this).contents().find(pageContainer+" "+f).unbind("hover").unbind("click")}});if($(this).val()=="content"){$("#pageList ul li iframe").each(function(){for(i=0;i<editableContent.length;++i){$(this).contents().find(pageContainer+" "+editableContent[i]).unbind("click").unbind("hover");$(this).contents().find(pageContainer+" "+editableContent[i]).hover(function(){$(this).css({outline:"3px dashed red",cursor:"pointer"})},function(){$(this).css({outline:"",cursor:""})}).click(function(f){b=$(this);f.preventDefault();f.stopPropagation();$("#editContentModal #contentToEdit").val($(this).html());$("#editContentModal").modal("show");if(this.tagName=="SMALL"||this.tagName=="A"||this.tagName=="LI"||this.tagName=="SPAN"||this.tagName=="B"||this.tagName=="I"||this.tagName=="TT"||this.tageName=="CODE"||this.tagName=="EM"||this.tagName=="STRONG"||this.tagName=="SUB"||this.tagName=="BUTTON"||this.tagName=="LABEL"||this.tagName=="P"||this.tagName=="H1"||this.tagName=="H2"||this.tagName=="H2"||this.tagName=="H3"||this.tagName=="H4"||this.tagName=="H5"||this.tagName=="H6"){$("#editContentModal #contentToEdit").redactor({buttons:["html","bold","italic","deleted"],focus:true,plugins:["bufferbuttons"],buttonSource:true,paragraphize:false,linebreaks:true})}else{if(this.tagName=="DIV"&&$(this).hasClass("tableWrapper")){$("#editContentModal #contentToEdit").redactor({buttons:["html","formatting","bold","italic","deleted","table","image","link","alignment"],focus:true,plugins:["table","bufferbuttons"],buttonSource:true,paragraphize:false,linebreaks:false})}else{$("#editContentModal #contentToEdit").redactor({buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","file","link","alignment","horizontalrule"],focus:true,buttonSource:true,paragraphize:false,linebreaks:false})}}}).each(function(){$(this).attr("data-selector",i)})}})}else{if($(this).val()=="block"){$("#pageList ul .frameCover").each(function(){$(this).show()});$("#pageList ul li iframe").each(function(){for(var f in editableItems){$(this).contents().find(pageContainer+" "+f).unbind("mouseenter mouseleave")}this.contentDocument.designMode="off"})}else{if($(this).val()=="styling"){$("#pageList ul li iframe").each(function(){$(this).contents().find(pageContainer+" p").unbind("click").unbind("hover");for(var f in editableItems){$(this).contents().find(pageContainer+" "+f).hover(function(g){g.stopPropagation();if($(this).closest("body").width()!=$(this).width()){$(this).css({outline:"3px dashed red",cursor:"pointer"})}else{$(this).css({outline:"3px dashed red","outline-offset":"-3px",cursor:"pointer"})}},function(){$(this).css({outline:"",cursor:"","outline-offset":""})}).click(function(g){g.preventDefault();g.stopPropagation();styleClick(this,f)}).each(function(){$(this).attr("data-selector",f)})}})}}}});$("button#updateContentInFrameSubmit").click(function(){var f;b.html($("#editContentModal #contentToEdit").redactor("code.get")).css({outline:"",cursor:""});f=hasSandbox(b);if(f){elementID=b.attr("id");$("#"+f).contents().find("#"+elementID).html($("#editContentModal #contentToEdit").redactor("code.get"))}$("#editContentModal textarea").each(function(){$(this).redactor("core.destroy");$(this).val("")});$("#editContentModal").modal("hide");$(this).closest("body").removeClass("modal-open").attr("style","");heightAdjustment(b.get(0));setPendingChanges(true)});$("#styleEditor > a.close").click(function(f){f.preventDefault();closeStyleEditor()});var a;$("#pageList").on("click",".frameCover > .deleteBlock",function(){$("#deleteBlock").modal("show");a=$(this).closest("li");$("#deleteBlock").off("click","#deleteBlockConfirm").on("click","#deleteBlockConfirm",function(){var f=a.find("iframe").attr("data-sandbox");if(typeof f!==typeof undefined&&f!==false){$("#sandboxes #"+f).remove()}$("#deleteBlock").modal("hide");a.fadeOut(500,function(){$(this).remove();pageEmpty();allEmpty();setPendingChanges(true)})})});$("#pageList").on("click",".frameCover > .resetBlock",function(){$("#resetBlock").modal("show");var f=$(this).closest("li").find("iframe");$("#resetBlock").off("click","#resetBlockConfirm").on("click","#resetBlockConfirm",function(){$("#resetBlock").modal("hide");f.get(0).contentWindow.location.reload();var g=f.attr("data-sandbox");if(typeof g!==typeof undefined&&g!==false){document.getElementById(g).contentDocument.location.reload(true)}})});var e=[];$("#pageList").on("click",".frameCover > .htmlBlock",function(){$(this).closest(".li").find("iframe").hide();$(this).closest("li").parent().sortable("disable");var j=$('<div class="aceEditor"></div>');j.uniqueId();if($(this).closest("li").height()<300){$(this).closest("li").height(300);j.height(300)}else{j.height($(this).closest("li").height())}$(this).closest("li").append(j);var g=j.attr("id");var h=ace.edit(g);var f=$(this).closest("li").find("iframe").attr("data-sandbox");if(typeof f!==typeof undefined&&f!==false){h.setValue($("#sandboxes #"+f).contents().find(pageContainer).html());document.getElementById(f).contentDocument.location.reload(true)}else{h.setValue($(this).closest("li").find("iframe").contents().find(pageContainer).html())}h.setTheme("ace/theme/twilight");h.getSession().setMode("ace/mode/html");var m=$('<button type="button" class="btn btn-danger editCancelButton btn-wide"><span class="fui-cross"></span> Отмена</button>');var l=$('<button type="button" class="btn btn-primary editSaveButton btn-wide"><span class="fui-check"></span> Сохранить</button>');var k=$('<div class="editorButtons"></div>');k.append(m);k.append(l);$(this).closest("li").append(k);e[g]=h});$("#pageList").on("click","li .editorButtons .editCancelButton",function(){heightAdjustment($(this).closest("li").find("iframe").attr("id"),true);$(this).closest("li").parent().sortable("enable");$(this).parent().prev().remove();$(this).closest("li").find(".zoomer-small iframe").fadeIn(500);$(this).parent().fadeOut(500,function(){$(this).remove()})});$("#pageList").on("click","li .editorButtons .editSaveButton",function(){$(this).closest("li").parent().sortable("enable");var k=$(this).closest(".editorButtons").prev().attr("id");var h=e[k].getValue();var g=$(this).closest("li").find("iframe");$(this).parent().prev().remove();var f=$(this).closest("li").find("iframe").attr("data-sandbox");if(typeof f!==typeof undefined&&f!==false){$("#sandboxes #"+f).contents().find(pageContainer).html(h);$(this).closest("li").find("iframe").show().contents().find(pageContainer).html(h);if(typeof g.attr("data-loaderfunction")!==typeof undefined&&g.attr("data-loaderfunction")!==false){var j="theiFrame[0].contentWindow."+g.attr("data-loaderfunction")+"()";var l=new Function(j);l()}}else{$(this).closest("li").find("iframe").show().contents().find(pageContainer).html(h)}heightAdjustment($(this).closest("li").find("iframe").attr("id"),true);$(this).parent().fadeOut(500,function(){$(this).remove()});setPendingChanges(true)});$("#savePage").click(function(f){f.preventDefault();savePage(f)});$("#previewModal").on("show.bs.modal",function(f){$("#previewModal > form #showPreview").show("");$("#previewModal > form #previewCancel").text("Закрыть");closeStyleEditor()});$("#previewModal").on("shown.bs.modal",function(g){var h;var f;$('#previewModal form input[type="hidden"]').remove();$("#pageList > ul:visible").each(function(){h=$("iframe#skeleton").contents().find(pageContainer);h.find("*").remove();$(this).find("iframe").each(function(){var l=$(this).attr("data-sandbox");if(typeof l!==typeof undefined&&l!==false){f=$("#sandboxes #"+l).contents().find(pageContainer)}else{f=$(this).contents().find(pageContainer)}f.find(".frameCover").each(function(){$(this).remove()});for(var o in editableItems){f.find(o).each(function(){$(this).removeAttr("data-selector");if($(this).attr("style")==""){$(this).removeAttr("style")}})}for(var n=0;n<editableContent.length;++n){$(this).contents().find(editableContent[n]).each(function(){$(this).removeAttr("data-selector")})}var m=f.html();var k=$(this).contents().find(pageContainer).find("script");if(k.size()>0){var p=document.getElementById("skeleton");k.each(function(){if($(this).text()!=""){var q=p.contentWindow.document.createElement("script");q.type="text/javascript";q.innerHTML=$(this).text();p.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(q)}else{if($(this).attr("src")!=null){var q=p.contentWindow.document.createElement("script");q.type="text/javascript";q.src=$(this).attr("src");p.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(q)}}})}h.append($(m))});var j=$('<input type="hidden" name="page" value="">');$("#previewModal form").prepend(j);j.val("<html>"+$("iframe#skeleton").contents().find("html").html()+"</html>")})});$("#previewModal > form").submit(function(){$("#previewModal > form #showPreview").hide("");$("#previewModal > form #previewCancel").text("Закрыть")});$("#xsDgnInput").on("change",function(){var f=this.value.match(/\.(.+)$/)[1];if($.inArray(f,["xs"])==-1){var g="Please upload save Project file!";$("#xsErrorModal .modal-body").html(g);$("#xsErrorModal").modal("show")}else{$("#xsclearCanvas").modal("show");$("#xsImpModal").modal("hide")}});$("#xsclearCanvasImport").on("click",function(){$("#xsImportForm").submit()});$("#exportModal").on("show.bs.modal",function(f){$("#exportModal > form #exportSubmit").show("");$("#exportModal > form #exportCancel").text("Отменить и закрыть");closeStyleEditor()});$("#exportModal").on("shown.bs.modal",function(f){$("#pageList > ul").each(function(){var j;var h;var k=$("iframe#skeleton").contents().find(pageContainer);k.find("*").remove();$(this).find("iframe").each(function(){var m=$(this).attr("data-sandbox");if(typeof m!==typeof undefined&&m!==false){h=$("#sandboxes #"+m).contents().find(pageContainer)}else{h=$(this).contents().find(pageContainer)}h.find(".frameCover").each(function(){$(this).remove()});for(var o in editableItems){h.find(o).each(function(){$(this).removeAttr("data-selector");if($(this).attr("style")==""){$(this).removeAttr("style")}})}for(var n=0;n<editableContent.length;++n){$(this).contents().find(editableContent[n]).each(function(){$(this).removeAttr("data-selector")})}j=h.html();var l=$(this).contents().find(pageContainer).find("script");if(l.size()>0){var p=document.getElementById("skeleton");l.each(function(){if($(this).text()!=""){var q=p.contentWindow.document.createElement("script");q.type="text/javascript";q.innerHTML=$(this).text();p.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(q)}else{if($(this).attr("src")!=null){var q=p.contentWindow.document.createElement("script");q.type="text/javascript";q.src=$(this).attr("src");p.contentWindow.document.getElementById(pageContainer.substring(1)).appendChild(q)}}})}k.append($(j))});var g=$('<input type="hidden" name="pages['+$("#pages li:eq("+($(this).index()+1)+") a:first").text()+']" value="">');$("#exportModal form").prepend(g);g.val("<html>"+$("iframe#skeleton").contents().find("html").html()+"</html>")})});$("#exportModal > form").submit(function(){$("#exportModal > form #exportSubmit").hide("");$("#exportModal > form #exportCancel").text("Закрыть")});$("#clearScreen").click(function(){$("#deleteAll").modal("show");$("#deleteAll").on("click","#deleteAllConfirm",function(){$("#deleteAll").modal("hide");$("#pageList ul:visible li").fadeOut(500,function(){$(this).remove();pageEmpty();allEmpty()});$("#sandboxes iframe").each(function(){$(this).remove()})});setPendingChanges(true)});$("#pages").on("blur","li > input",function(){if($(this).parent().find("a.plink").size()==0){theLink=$('<a href="#'+$(this).val()+'" class="plink">'+$(this).val()+"</a>");$(this).hide();$(this).closest("li").prepend(theLink);$(this).closest("li").removeClass("edit");$("#internalLinksDropdown option:eq("+$(this).parent().index()+")").text($(this).val()).attr("value",$(this).val()+".html");$("select#internalLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"});$(this).remove()}});$("#addPage").click(function(j){j.preventDefault();$("#pages li.active").each(function(){if($(this).find("input").size()>0){theLink=$('<a href="#">'+$(this).find("input").val()+"</a>");$(this).find("input").remove();$(this).prepend(theLink)}});$("#pages li").removeClass("active");newPageLI=$("#newPageLI").clone();newPageLI.css("display","block");newPageLI.find("input").val("page"+$("#pages li").size());newPageLI.attr("id","");$("ul#pages").append(newPageLI);theInput=newPageLI.find("input");theInput.focus();var f=theInput.val();theInput.val("");theInput.val(f);theInput.keyup(function(){$("#pageTitle span span").text($(this).val())});newPageLI.addClass("active").addClass("edit");var h=$("<ul></ul>");h.css("display","block");h.attr("id","page"+($("#pages li").size()-1));$("#pageList > ul").hide();$("#pageList").append(h);makeSortable(h);makeDraggable("#page"+($("#pages li").size()-1));$("#pageTitle span span").text("page"+($("#pages li").size()-1));$("#frameWrapper").addClass("empty");$("#start").fadeIn();var g=$('<option value="page'+($("#pages li").size()-1)+'.html">page'+($("#pages li").size()-1)+"</option>");$("#internalLinksDropdown").append(g);$("select#internalLinksDropdown").selectpicker({style:"btn-sm btn-default",menuStyle:"dropdown-inverse"});setPendingChanges(true)});$("#pages").on("click","li:not(.active)",function(){$("#pageList > ul").hide();$("#pageList > ul:eq("+($(this).index()-1)+")").show();pageEmpty();makeDraggable("#page"+($(this).index()));$("#pages li").removeClass("active").removeClass("edit");$(this).addClass("active");$("#pageTitle span span").text($(this).find("a").text())});$("#pages").on("click","li.active .fileSave",function(){var f=$(this).closest("li");if(f.find("input").size()>0){var g=$('<a href="#'+f.find("input").val()+'">'+f.find("input").val()+"</a>");f.find("input").remove();f.prepend(g)}$("#pages li").removeClass("edit")});$("#pages").on("click","li.active .fileEdit",function(){var h=$(this).closest("li");var g=$('<input type="text" value="'+h.find("a:first").text()+'" name="page">');h.find("a:first").remove();h.prepend(g);g.focus();var f=g.val();g.val("");g.val(f);g.keyup(function(){$("#pageTitle span span").text($(this).val())});h.addClass("edit");setPendingChanges(true)});var c;$("#pages").on("click","li.active .fileDel",function(){c=$(this).parent().parent().index();$("#deletePage").modal("show");$("#deletePageCancel").click(function(){$("#deletePage").modal("hide")});$("#deletePage").off("click").on("click","#deletePageConfirm",function(f){$("#deletePage").modal("hide");$("#pages li:eq("+c+")").remove();$("#pageList ul:visible").remove();$("select#internalLinksDropdown option:eq("+c+")").remove();$(".link_Tab .dropdown-menu li:eq("+c+")").remove();$("#pages li:eq(1)").addClass("active");$("#pageList ul:first").show();$("#pageTitle span span").text($("#pages li:eq(1)").find("a:first").text());makeDraggable("#page1");pageEmpty();allEmpty();savePage(f);setPendingChanges(true)})});$("#editContentModal").on("hidden.bs.modal",function(f){$("#editContentModal #contentToEdit").redactor("core.destroy")})});function savePage(f){var g=[];closeStyleEditor();var a=0;$("#pageList > ul").each(function(){g[a]={element:[],frame:[],page:[]};var c=$(this).attr("id");$(this).find("li").each(function(){g[a].frame.push($(this).html())});$(this).find("iframe").each(function(){var e=$(this).attr("data-sandbox");if(typeof e!==typeof undefined&&e!==false){theContents=$("#sandboxes #"+e).contents().find(pageContainer)}else{theContents=$(this).contents().find(pageContainer)}theContents.find(".frameCover").each(function(){$(this).remove()});for(var j in editableItems){theContents.find(j).each(function(){$(this).removeAttr("data-selector");if($(this).attr("style")==""){$(this).removeAttr("style")}})}for(i=0;i<editableContent.length;++i){$(this).contents().find(editableContent[i]).each(function(){$(this).removeAttr("data-selector")})}g[a].element.push(theContents.html())});a++});var h=0;$("ul#pages li:not(#newPageLI)").each(function(c){g[h].page=$(this).find("a").text();h++});var d=$("#savePageForm");var b=d.attr("action");$.ajax({url:b,data:JSON.stringify({domain_id:$("#selectDomain").val(),blocks:g}),cache:false,contentType:false,processData:false,dataType:"json",type:"POST"}).done(function(e,c,j){if(j.status==401){$("#auth .modal").modal("show")}else{setPendingChanges(false)}}).fail(function(e,c,j){$("#auth .modal").modal("show")})};